{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Animator/main/Animator.js","webpack:///./src/Canvas/main/Canvas.js","webpack:///./src/Canvas_old/main/Canvas.js","webpack:///./src/Canvas_old/main/Canvas2D.js","webpack:///./src/Canvas_old/main/ImageIO.js","webpack:///./src/Color/main/Color.js","webpack:///./src/Utils/main/Utils.js","webpack:///./src/index.js","webpack:///external \"@babel/runtime/helpers/esm/classCallCheck\"","webpack:///external \"@babel/runtime/helpers/esm/createClass\"","webpack:///external \"@babel/runtime/helpers/esm/defineProperty\"","webpack:///external \"@babel/runtime/helpers/esm/getPrototypeOf\"","webpack:///external \"@babel/runtime/helpers/esm/inherits\"","webpack:///external \"@babel/runtime/helpers/esm/possibleConstructorReturn\"","webpack:///external \"@babel/runtime/helpers/esm/wrapNativeSuper\""],"names":["Animator","state","next","doWhile","requestAnimeId","requestAnimationFrame","stop","play","cancelAnimationFrame","AnimatorBuilder","_state","_next","_end","end","someAreEmpty","some","x","undefined","Error","Canvas","canvas","getCanvas","ctx","getContext","image","getImageData","width","height","imgBuffer","data","color","fillStyle","red","green","blue","alpha","fillRect","lambda","n","length","w","i","Math","floor","y","Color","ofRGBA","j","CanvasException","index","putImageData","CanvasBuilder","document","createElement","_width","_height","_canvas","setAttribute","scale","u","r","ans","add","v","diff","dot","squareNorm","norm","sqrt","min","max","solve2by2UpperTriMatrix","h","z","aux","solve2by2LowerTriMatrix","imageData","prototype","getSize","paintImage","clearImage","rgba","useCanvasCtx","size","globalCompositeOperation","isClearImage","getImageIndex","getPxl","drawPxl","rgb","drawLine","x1","x2","shader","points","stack","push","inStack","outStack","drawLineInt","intersectionSolutions","validIntersection","p","pop","p0","nn","tangent","normal","fmin","Number","MAX_VALUE","minDir","k","nextX","f","abs","drawPolygon","array","isInsidePoly","isInsidePolygon","upperBox","MIN_VALUE","clampedSize","zeros","drawTriangle","x3","isInsideConvex","drawQuad","x4","drawImage","img","isReady","drawCircle","corner","isInsideCircle","addEventListener","key","useCapture","drawString","string","contextShader","fillText","theta","acos","PI","m","vDotN","orientation","myDot","simpleShader","element","colorShader","colors","auxShader","poly","interpolateColors","interpolateTriangleShader","interpolateQuadShader","quad","t1","t2","triangleBaryCoord","triangle","interpolateLineShader","line","vnorm","projection","t","quadTextureShader","quadTexCoord","interpolation","bilinearInterpolation","imageCache","imageShader","ImageIO","getImageCanvas","imageCanvas","imgSize","interpolateTexCoord","cornerColors","finalColor","triangleCache","hashMap","constains","triangleHash","get","set","value","reduce","hash","det","map","cache","values","acc","f03","f12","createCanvas","domId","getElementById","appendChild","Canvas2D","cameraSpace","call","Object","create","constructor","integerTransform","xint","yint","inverseTransform","xt","yt","y1","y2","y3","y4","setCamera","camera","canvasAux","contextAux","getDataFromImage","loadImage","src","Image","onload","generateImageReadyPredicate","Uint8Array","random","ArrayUtils","TYPED_ARRAY","Uint8ArrayFactory","perf","performance","now","answer"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;;;;;;;;;;IClFqBA,Q;AACnB,oBAAYC,KAAZ,EAAmBC,IAAnB,EAAyBC,OAAzB,EAAkC;AAAA;;AAChC,SAAKF,KAAL,GAAaA,KAAb;AACA,SAAKC,IAAL,GAAYA,IAAZ;AACA,oBAAaC,OAAb;AACA,SAAKC,cAAL,GAAsB,IAAtB;AACD;;;;WAED,gBAAO;AAAA;;AACL,WAAKA,cAAL,GAAsBC,qBAAqB,CAAC,YAAM;AAChD,YAAI,CAAC,KAAI,SAAJ,CAAW,KAAI,CAACJ,KAAhB,CAAL,EAA6B,OAAO,KAAI,CAACK,IAAL,EAAP;AAC7B,aAAI,CAACL,KAAL,GAAa,KAAI,CAACC,IAAL,CAAU,KAAI,CAACD,KAAf,CAAb;;AACA,aAAI,CAACM,IAAL;AACD,OAJ0C,CAA3C;AAKA,aAAO,IAAP;AACD;;;WAED,gBAAO;AACLC,0BAAoB,CAAC,KAAKJ,cAAN,CAApB;AACA,aAAO,IAAP;AACD;;;WAED,mBAAiB;AACf,aAAO,IAAIK,eAAJ,EAAP;AACD;;;;;;;;IAGGA,e;AACJ,6BAAc;AAAA;;AACZ,SAAKC,MAAL,GAAc,IAAd;AACA,SAAKC,KAAL,GAAa,IAAb;AACA,SAAKC,IAAL,GAAY,IAAZ;AACD;;;;WAED,sBAAaX,KAAb,EAAoB;AAClB,WAAKS,MAAL,GAAcT,KAAd;AACA,aAAO,IAAP;AACD;;;WAED,mBAAUC,IAAV,EAAgB;AACd,WAAKS,KAAL,GAAaT,IAAb;AACA,aAAO,IAAP;AACD;;;WAED,gBAAMW,GAAN,EAAW;AACT,WAAKD,IAAL,GAAYC,GAAZ;AACA,aAAO,IAAP;AACD;;;WAED,iBAAQ;AACN,UAAMC,YAAY,GAAG,CAAC,KAAKJ,MAAN,EAAc,KAAKC,KAAnB,EAA0B,KAAKC,IAA/B,EAAqCG,IAArC,CACnB,UAACC,CAAD;AAAA,eAAOA,CAAC,KAAK,IAAN,IAAcA,CAAC,KAAKC,SAA3B;AAAA,OADmB,CAArB;AAGA,UAAIH,YAAJ,EAAkB,MAAM,IAAII,KAAJ,CAAU,iCAAV,CAAN;AAClB,aAAO,IAAIlB,QAAJ,CAAa,KAAKU,MAAlB,EAA0B,KAAKC,KAA/B,EAAsC,KAAKC,IAA3C,CAAP;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvDH;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;IAEqBO,M;AACnB;AACF;AACA;AACA;AACE,kBAAYC,MAAZ,EAAoB;AAAA;;AAAA,qGAYX,KAAKC,SAZM;;AAClB,SAAKD,MAAL,GAAcA,MAAd;AACA,SAAKE,GAAL,GAAWF,MAAM,CAACG,UAAP,CAAkB,IAAlB,CAAX;AACA,SAAKC,KAAL,GAAa,KAAKF,GAAL,CAASG,YAAT,CAAsB,CAAtB,EAAyB,CAAzB,EAA4BL,MAAM,CAACM,KAAnC,EAA0CN,MAAM,CAACO,MAAjD,CAAb,CAHkB,CAIlB;;AACA,SAAKC,SAAL,GAAiB,KAAKJ,KAAL,CAAWK,IAA5B;AACD;;;;WAED,qBAAY;AACV,aAAO,KAAKT,MAAZ;AACD;;;WAID;;AACA;AACF;AACA;AACE;;AAEA;AACF;AACA;AACA;AACE,kBAAKU,KAAL,EAAY;AACV,WAAKR,GAAL,CAASS,SAAT,kBAA6BD,KAAK,CAACE,GAAnC,eAA2CF,KAAK,CAACG,KAAjD,eAA2DH,KAAK,CAACI,IAAjE,eACEJ,KAAK,CAACK,KAAN,GAAc,KADhB;AAGA,WAAKb,GAAL,CAASc,QAAT,CAAkB,CAAlB,EAAqB,CAArB,EAAwB,KAAKhB,MAAL,CAAYM,KAApC,EAA2C,KAAKN,MAAL,CAAYO,MAAvD;AACA,WAAKH,KAAL,GAAa,KAAKF,GAAL,CAASG,YAAT,CACX,CADW,EAEX,CAFW,EAGX,KAAKL,MAAL,CAAYM,KAHD,EAIX,KAAKN,MAAL,CAAYO,MAJD,CAAb;AAMA,WAAKC,SAAL,GAAiB,KAAKJ,KAAL,CAAWK,IAA5B;AACA,aAAO,IAAP;AACD;AAED;AACF;AACA;AACA;;;;WACE,eAAuB;AAAA,UAAnBQ,MAAmB,uEAAV,YAAM,CAAE,CAAE;AACrB,UAAMC,CAAC,GAAG,KAAKV,SAAL,CAAeW,MAAzB;AACA,UAAeC,CAAf,GAAqB,KAAKpB,MAA1B,CAAQM,KAAR;;AACA,WAAK,IAAIe,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,CAApB,EAAuBG,CAAC,IAAI,CAA5B,EAA+B;AAC7B,YAAMzB,CAAC,GAAG0B,IAAI,CAACC,KAAL,CAAWF,CAAC,IAAI,IAAID,CAAR,CAAZ,CAAV;AACA,YAAMI,CAAC,GAAGF,IAAI,CAACC,KAAL,CAAWF,CAAC,GAAG,CAAf,IAAoBD,CAA9B;AACA,YAAMV,KAAK,GAAGO,MAAM,CAClBQ,yDAAK,CAACC,MAAN,CACE,KAAKlB,SAAL,CAAea,CAAf,CADF,EAEE,KAAKb,SAAL,CAAea,CAAC,GAAG,CAAnB,CAFF,EAGE,KAAKb,SAAL,CAAea,CAAC,GAAG,CAAnB,CAHF,EAIE,KAAKb,SAAL,CAAea,CAAC,GAAG,CAAnB,CAJF,CADkB,EAOlBzB,CAPkB,EAQlB4B,CARkB,CAApB;AAUA,aAAKhB,SAAL,CAAea,CAAf,IAAoBX,KAAK,CAACE,GAA1B;AACA,aAAKJ,SAAL,CAAea,CAAC,GAAG,CAAnB,IAAwBX,KAAK,CAACG,KAA9B;AACA,aAAKL,SAAL,CAAea,CAAC,GAAG,CAAnB,IAAwBX,KAAK,CAACI,IAA9B;AACA,aAAKN,SAAL,CAAea,CAAC,GAAG,CAAnB,IAAwBX,KAAK,CAACK,KAA9B;AACD;;AACD,aAAO,IAAP;AACD;AAED;AACF;AACA;AACA;AACA;AACA;;;;WACE,gBAAOM,CAAP,EAAUM,CAAV,EAAa;AACX,yBAA0B,KAAK3B,MAA/B;AAAA,UAAQM,KAAR,gBAAQA,KAAR;AAAA,UAAeC,MAAf,gBAAeA,MAAf;AACA,UAAI,CAACc,CAAC,GAAG,CAAJ,IAASA,CAAC,IAAId,MAAf,MAA2BoB,CAAC,GAAG,CAAJ,IAASA,CAAC,IAAIrB,KAAzC,CAAJ,EACE,OAAO,IAAIsB,eAAJ,CAAoB,mBAApB,CAAP;AACF,UAAMR,CAAC,GAAGd,KAAK,GAAG,CAAlB;AACA,UAAMuB,KAAK,GAAGR,CAAC,GAAGD,CAAJ,GAAQ,IAAIO,CAA1B;AACA,aAAOF,yDAAK,CAACC,MAAN,CACL,KAAKlB,SAAL,CAAeqB,KAAf,CADK,EAEL,KAAKrB,SAAL,CAAeqB,KAAK,GAAG,CAAvB,CAFK,EAGL,KAAKrB,SAAL,CAAeqB,KAAK,GAAG,CAAvB,CAHK,EAIL,KAAKrB,SAAL,CAAeqB,KAAK,GAAG,CAAvB,CAJK,CAAP;AAMD;AAED;AACF;AACA;AACA;AACA;AACA;;;;WACE,gBAAOR,CAAP,EAAUM,CAAV,EAAajB,KAAb,EAAoB;AAClB,0BAA0B,KAAKV,MAA/B;AAAA,UAAQM,KAAR,iBAAQA,KAAR;AAAA,UAAeC,MAAf,iBAAeA,MAAf;AACA,UAAI,CAACc,CAAC,GAAG,CAAJ,IAASA,CAAC,IAAId,MAAf,MAA2BoB,CAAC,GAAG,CAAJ,IAASA,CAAC,IAAIrB,KAAzC,CAAJ,EAAqD;AACrD,UAAMc,CAAC,GAAGd,KAAK,GAAG,CAAlB;AACA,UAAMuB,KAAK,GAAGR,CAAC,GAAGD,CAAJ,GAAQ,IAAIO,CAA1B;AACA,WAAKnB,SAAL,CAAeqB,KAAf,IAAwBnB,KAAK,CAACE,GAA9B;AACA,WAAKJ,SAAL,CAAeqB,KAAK,GAAG,CAAvB,IAA4BnB,KAAK,CAACG,KAAlC;AACA,WAAKL,SAAL,CAAeqB,KAAK,GAAG,CAAvB,IAA4BnB,KAAK,CAACI,IAAlC;AACA,WAAKN,SAAL,CAAeqB,KAAK,GAAG,CAAvB,IAA4BnB,KAAK,CAACK,KAAlC;AACA,aAAO,IAAP;AACD;;;WAED,iBAAQ;AACN,WAAKb,GAAL,CAAS4B,YAAT,CAAsB,KAAK1B,KAA3B,EAAkC,CAAlC,EAAqC,CAArC;AACD,K,CAED;;AACA;AACF;AACA;AACE;;;;WAEA,mBAAiB;AACf,aAAO,IAAI2B,aAAJ,EAAP;AACD;;;;;;;;IAGGA,a;AAIJ,2BAAc;AAAA;;AAAA,sGAHJC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAGI;;AAAA,qGAFL,GAEK;;AAAA,sGADJ,GACI;AAAE;;;;WAEhB,eAAM3B,MAAN,EAAa;AACX,WAAK4B,MAAL,GAAc5B,MAAd;AACA,aAAO,IAAP;AACD;;;WAED,gBAAOC,OAAP,EAAe;AACb,WAAK4B,OAAL,GAAe5B,OAAf;AACA,aAAO,IAAP;AACD;;;WAED,iBAAQ;AACN,WAAK6B,OAAL,CAAaC,YAAb,CAA0B,OAA1B,EAAmC,KAAKH,MAAxC;;AACA,WAAKE,OAAL,CAAaC,YAAb,CAA0B,QAA1B,EAAoC,KAAKF,OAAzC;;AACA,aAAO,IAAIpC,MAAJ,CAAW,KAAKqC,OAAhB,CAAP;AACD;;;;;;AAGI,IAAMR,eAAb;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,kGAAqC9B,KAArC,G;;;;;;;;;;;;ACpLA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;;AACA,SAASwC,KAAT,CAAeC,CAAf,EAAkBC,CAAlB,EAAqB;AACnB,MAAIC,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAhB;AACAC,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOC,CAAhB;AACA,SAAOC,GAAP;AACD;;AAED,SAASC,GAAT,CAAaH,CAAb,EAAgBI,CAAhB,EAAmB;AACjB,MAAIF,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAAjB;AACAF,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAAjB;AACA,SAAOF,GAAP;AACD;;AAED,SAASlB,KAAT,CAAe3B,CAAf,EAAkB;AAChB,MAAI6C,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAACC,KAAL,CAAW3B,CAAC,CAAC,CAAD,CAAZ,CAAT;AACA6C,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAACC,KAAL,CAAW3B,CAAC,CAAC,CAAD,CAAZ,CAAT;AACA,SAAO6C,GAAP;AACD;;AAED,SAASG,IAAT,CAAcL,CAAd,EAAiBI,CAAjB,EAAoB;AAClB,MAAIF,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAAjB;AACAF,KAAG,CAAC,CAAD,CAAH,GAASF,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAAjB;AACA,SAAOF,GAAP;AACD;;AAED,SAASI,GAAT,CAAaN,CAAb,EAAgBI,CAAhB,EAAmB;AACjB,SAAOJ,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAAR,GAAcJ,CAAC,CAAC,CAAD,CAAD,GAAOI,CAAC,CAAC,CAAD,CAA7B;AACD;;AAED,SAASG,UAAT,CAAoBlD,CAApB,EAAuB;AACrB,SAAOiD,GAAG,CAACjD,CAAD,EAAIA,CAAJ,CAAV;AACD;;AAED,SAASmD,IAAT,CAAcnD,CAAd,EAAiB;AACf,SAAO0B,IAAI,CAAC0B,IAAL,CAAUH,GAAG,CAACjD,CAAD,EAAIA,CAAJ,CAAb,CAAP;AACD;;AAED,SAASqD,GAAT,CAAaV,CAAb,EAAgBI,CAAhB,EAAmB;AACjB,MAAIF,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAAC2B,GAAL,CAASV,CAAC,CAAC,CAAD,CAAV,EAAeI,CAAC,CAAC,CAAD,CAAhB,CAAT;AACAF,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAAC2B,GAAL,CAASV,CAAC,CAAC,CAAD,CAAV,EAAeI,CAAC,CAAC,CAAD,CAAhB,CAAT;AACA,SAAOF,GAAP;AACD;;AAED,SAASS,GAAT,CAAaX,CAAb,EAAgBI,CAAhB,EAAmB;AACjB,MAAIF,GAAG,GAAG,EAAV;AACAA,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAAC4B,GAAL,CAASX,CAAC,CAAC,CAAD,CAAV,EAAeI,CAAC,CAAC,CAAD,CAAhB,CAAT;AACAF,KAAG,CAAC,CAAD,CAAH,GAASnB,IAAI,CAAC4B,GAAL,CAASX,CAAC,CAAC,CAAD,CAAV,EAAeI,CAAC,CAAC,CAAD,CAAhB,CAAT;AACA,SAAOF,GAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASU,uBAAT,CAAiCZ,CAAjC,EAAoCa,CAApC,EAAuCC,CAAvC,EAA0C;AACxC,MAAIC,GAAG,GAAGD,CAAC,CAAC,CAAD,CAAD,GAAOd,CAAC,CAAC,CAAD,CAAlB;AACA,SAAO,CAACe,GAAD,EAAM,CAAC,CAACf,CAAC,CAAC,CAAD,CAAF,GAAQe,GAAR,GAAcD,CAAC,CAAC,CAAD,CAAhB,IAAuBD,CAA7B,CAAP;AACD;AACD;AACA;AACA;AACA;AACA;;;AACA,SAASG,uBAAT,CAAiChB,CAAjC,EAAoCnB,CAApC,EAAuCiC,CAAvC,EAA0C;AACxC,MAAIC,GAAG,GAAGD,CAAC,CAAC,CAAD,CAAD,GAAOd,CAAC,CAAC,CAAD,CAAlB;AACA,SAAO,CAACe,GAAD,EAAM,CAAC,CAACf,CAAC,CAAC,CAAD,CAAF,GAAQe,GAAR,GAAcD,CAAC,CAAC,CAAD,CAAhB,IAAuBjC,CAA7B,CAAP;AACD,C,CAED;;;AACA,IAAIrB,MAAM,GAAG,SAATA,MAAS,CAAUC,MAAV,EAAkB;AAC7B,OAAKA,MAAL,GAAcA,MAAd;AACA,OAAKE,GAAL,GAAWF,MAAM,CAACG,UAAP,CAAkB,IAAlB,CAAX;AACA,OAAKC,KAAL,GAAa,KAAKF,GAAL,CAASG,YAAT,CAAsB,CAAtB,EAAyB,CAAzB,EAA4BL,MAAM,CAACM,KAAnC,EAA0CN,MAAM,CAACO,MAAjD,CAAb,CAH6B,CAI7B;;AACA,OAAKiD,SAAL,GAAiB,KAAKpD,KAAL,CAAWK,IAA5B;AACD,CAND;AAQA;AACA;AACA;;;AACAV,MAAM,CAAC0D,SAAP,CAAiBC,OAAjB,GAA2B,YAAY;AACrC,SAAO,CAAC,KAAK1D,MAAL,CAAYO,MAAb,EAAqB,KAAKP,MAAL,CAAYM,KAAjC,CAAP;AACD,CAFD;AAIA;AACA;AACA;;;AACAP,MAAM,CAAC0D,SAAP,CAAiBE,UAAjB,GAA8B,YAAY;AACxC,OAAKzD,GAAL,CAAS4B,YAAT,CAAsB,KAAK1B,KAA3B,EAAkC,CAAlC,EAAqC,CAArC;AACD,CAFD;;AAIAL,MAAM,CAAC0D,SAAP,CAAiBxD,SAAjB,GAA6B,YAAY;AACvC,SAAO,KAAKD,MAAZ;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AACAD,MAAM,CAAC0D,SAAP,CAAiBG,UAAjB,GAA8B,UAAUC,IAAV,EAAgB;AAC5C,OAAKC,YAAL,CAAkB,UAAC9D,MAAD,EAAY;AAC5B,QAAI+D,IAAI,GAAG/D,MAAM,CAAC0D,OAAP,EAAX;AACA1D,UAAM,CAACE,GAAP,CAAWS,SAAX,GACE,UAAUkD,IAAI,CAAC,CAAD,CAAd,GAAoB,GAApB,GAA0BA,IAAI,CAAC,CAAD,CAA9B,GAAoC,GAApC,GAA0CA,IAAI,CAAC,CAAD,CAA9C,GAAoD,GAApD,GAA0DA,IAAI,CAAC,CAAD,CAA9D,GAAoE,GADtE;AAEA7D,UAAM,CAACE,GAAP,CAAW8D,wBAAX,GAAsC,aAAtC;AACAhE,UAAM,CAACE,GAAP,CAAWc,QAAX,CAAoB,CAApB,EAAuB,CAAvB,EAA0B+C,IAAI,CAAC,CAAD,CAA9B,EAAmCA,IAAI,CAAC,CAAD,CAAvC;AACD,GAND,EAMG,IANH;AAOD,CARD;;AAUAhE,MAAM,CAAC0D,SAAP,CAAiBK,YAAjB,GAAgC,UAAU7C,MAAV,EAAwC;AAAA,MAAtBgD,YAAsB,uEAAP,KAAO;;AACtE,MAAI,CAACA,YAAL,EAAmB;AACjB,SAAK/D,GAAL,CAAS4B,YAAT,CAAsB,KAAK1B,KAA3B,EAAkC,CAAlC,EAAqC,CAArC;AACD;;AACDa,QAAM,CAAC,IAAD,CAAN;AACA,OAAKb,KAAL,GAAa,KAAKF,GAAL,CAASG,YAAT,CACX,CADW,EAEX,CAFW,EAGX,KAAKL,MAAL,CAAYM,KAHD,EAIX,KAAKN,MAAL,CAAYO,MAJD,CAAb;AAMA,OAAKiD,SAAL,GAAiB,KAAKpD,KAAL,CAAWK,IAA5B;AACD,CAZD;;AAcAV,MAAM,CAAC0D,SAAP,CAAiBS,aAAjB,GAAiC,UAAUtE,CAAV,EAAa;AAC5C,SAAO,KAAK,KAAKI,MAAL,CAAYM,KAAZ,GAAoBV,CAAC,CAAC,CAAD,CAArB,GAA2BA,CAAC,CAAC,CAAD,CAAjC,CAAP;AACD,CAFD;;AAIAG,MAAM,CAAC0D,SAAP,CAAiBU,MAAjB,GAA0B,UAAUvE,CAAV,EAAa;AACrC,MAAIiC,KAAK,GAAG,KAAKqC,aAAL,CAAmBtE,CAAnB,CAAZ;AACA,SAAO,CACL,KAAK4D,SAAL,CAAe3B,KAAf,CADK,EAEL,KAAK2B,SAAL,CAAe3B,KAAK,GAAG,CAAvB,CAFK,EAGL,KAAK2B,SAAL,CAAe3B,KAAK,GAAG,CAAvB,CAHK,EAIL,KAAK2B,SAAL,CAAe3B,KAAK,GAAG,CAAvB,CAJK,CAAP;AAMD,CARD;;AAUA9B,MAAM,CAAC0D,SAAP,CAAiBW,OAAjB,GAA2B,UAAUxE,CAAV,EAAayE,GAAb,EAAkB;AAC3C,MAAIxC,KAAK,GAAG,KAAKqC,aAAL,CAAmBtE,CAAnB,CAAZ;AACA,OAAK4D,SAAL,CAAe3B,KAAf,IAAwBwC,GAAG,CAAC,CAAD,CAA3B;AACA,OAAKb,SAAL,CAAe3B,KAAK,GAAG,CAAvB,IAA4BwC,GAAG,CAAC,CAAD,CAA/B;AACA,OAAKb,SAAL,CAAe3B,KAAK,GAAG,CAAvB,IAA4BwC,GAAG,CAAC,CAAD,CAA/B;AACA,OAAKb,SAAL,CAAe3B,KAAK,GAAG,CAAvB,IAA4BwC,GAAG,CAAC,CAAD,CAA/B;AACD,CAND;AAQA;AACA;AACA;AACA;AACA;;;AACAtE,MAAM,CAAC0D,SAAP,CAAiBa,QAAjB,GAA4B,UAAUC,EAAV,EAAcC,EAAd,EAAkBC,MAAlB,EAA0B;AACpD;AACAA,QAAM,CAACC,MAAP,GAAgB,CAACH,EAAD,EAAKC,EAAL,CAAhB,CAFoD,CAIpD;;AACA,MAAIG,KAAK,GAAG,EAAZ;AACAA,OAAK,CAACC,IAAN,CAAWL,EAAX;AACAI,OAAK,CAACC,IAAN,CAAWJ,EAAX;AACA,MAAIK,OAAO,GAAG,EAAd;AACA,MAAIC,QAAQ,GAAG,EAAf;;AACA,OAAK,IAAIzD,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGsD,KAAK,CAACxD,MAA1B,EAAkCE,CAAC,EAAnC,EAAuC;AACrC,QAAIzB,CAAC,GAAG+E,KAAK,CAACtD,CAAD,CAAb;;AACA,QACE,KAAKzB,CAAC,CAAC,CAAD,CAAN,IACAA,CAAC,CAAC,CAAD,CAAD,GAAO,KAAKI,MAAL,CAAYO,MADnB,IAEA,KAAKX,CAAC,CAAC,CAAD,CAFN,IAGAA,CAAC,CAAC,CAAD,CAAD,GAAO,KAAKI,MAAL,CAAYM,KAJrB,EAKE;AACAuE,aAAO,CAACD,IAAR,CAAahF,CAAb;AACD,KAPD,MAOO;AACLkF,cAAQ,CAACF,IAAT,CAAchF,CAAd;AACD;AACF,GAtBmD,CAuBpD;;;AACA,MAAIiF,OAAO,CAAC1D,MAAR,IAAkB,CAAtB,EAAyB;AACvB,SAAK4D,WAAL,CAAiBF,OAAO,CAAC,CAAD,CAAxB,EAA6BA,OAAO,CAAC,CAAD,CAApC,EAAyCJ,MAAzC;AACA;AACD,GA3BmD,CA4BpD;;;AACA,MAAIO,qBAAqB,GAAG,EAA5B;AACA,MAAIrC,CAAC,GAAG,CAAC6B,EAAE,CAAC,CAAD,CAAF,GAAQD,EAAE,CAAC,CAAD,CAAX,EAAgBC,EAAE,CAAC,CAAD,CAAF,GAAQD,EAAE,CAAC,CAAD,CAA1B,CAAR,CA9BoD,CA+BpD;AACA;;AACAS,uBAAqB,CAACJ,IAAtB,CACEzB,uBAAuB,CAACR,CAAD,EAAI,EAAE,KAAK3C,MAAL,CAAYO,MAAZ,GAAqB,CAAvB,CAAJ,EAA+B,CAAC,CAACgE,EAAE,CAAC,CAAD,CAAJ,EAAS,CAACA,EAAE,CAAC,CAAD,CAAZ,CAA/B,CADzB,EAjCoD,CAoCpD;;AACAS,uBAAqB,CAACJ,IAAtB,CACErB,uBAAuB,CAACZ,CAAD,EAAI,EAAE,KAAK3C,MAAL,CAAYM,KAAZ,GAAoB,CAAtB,CAAJ,EAA8B,CACnD,KAAKN,MAAL,CAAYO,MAAZ,GAAqB,CAArB,GAAyBgE,EAAE,CAAC,CAAD,CADwB,EAEnD,CAACA,EAAE,CAAC,CAAD,CAFgD,CAA9B,CADzB,EArCoD,CA2CpD;;AACAS,uBAAqB,CAACJ,IAAtB,CACEzB,uBAAuB,CAACR,CAAD,EAAI,KAAK3C,MAAL,CAAYO,MAAZ,GAAqB,CAAzB,EAA4B,CACjD,KAAKP,MAAL,CAAYO,MAAZ,GAAqB,CAArB,GAAyBgE,EAAE,CAAC,CAAD,CADsB,EAEjD,KAAKvE,MAAL,CAAYM,KAAZ,GAAoB,CAApB,GAAwBiE,EAAE,CAAC,CAAD,CAFuB,CAA5B,CADzB,EA5CoD,CAkDpD;;AACAS,uBAAqB,CAACJ,IAAtB,CACErB,uBAAuB,CAACZ,CAAD,EAAI,KAAK3C,MAAL,CAAYM,KAAZ,GAAoB,CAAxB,EAA2B,CAChD,CAACiE,EAAE,CAAC,CAAD,CAD6C,EAEhD,KAAKvE,MAAL,CAAYM,KAAZ,GAAoB,CAApB,GAAwBiE,EAAE,CAAC,CAAD,CAFsB,CAA3B,CADzB;AAOA,MAAIU,iBAAiB,GAAG,EAAxB;;AACA,OAAK,IAAI5D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2D,qBAAqB,CAAC7D,MAA1C,EAAkDE,CAAC,EAAnD,EAAuD;AACrD,QAAIzB,CAAC,GAAGoF,qBAAqB,CAAC3D,CAAD,CAA7B;;AACA,QAAI,KAAKzB,CAAC,CAAC,CAAD,CAAN,IAAaA,CAAC,CAAC,CAAD,CAAD,IAAQ,CAArB,IAA0B,KAAKA,CAAC,CAAC,CAAD,CAAhC,IAAuCA,CAAC,CAAC,CAAD,CAAD,IAAQ,CAAnD,EAAsD;AACpDqF,uBAAiB,CAACL,IAAlB,CAAuBhF,CAAvB;AACD;AACF;;AAED,MAAIqF,iBAAiB,CAAC9D,MAAlB,IAA4B,CAAhC,EAAmC,OAlEiB,CAoEpD;;AACA,MAAI0D,OAAO,CAAC1D,MAAR,GAAiB,CAArB,EAAwB;AACtB,QAAI+D,CAAC,GAAG,CACNX,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC,CAAD,CAAjB,CAAqB,CAArB,IAA0BtC,CAAC,CAAC,CAAD,CAD7B,EAEN4B,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC,CAAD,CAAjB,CAAqB,CAArB,IAA0BtC,CAAC,CAAC,CAAD,CAF7B,CAAR;AAIA,SAAKoC,WAAL,CAAiBF,OAAO,CAACM,GAAR,EAAjB,EAAgCD,CAAhC,EAAmCT,MAAnC;AACA;AACD;;AAED,MAAIW,EAAE,GAAG,CACPb,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC,CAAD,CAAjB,CAAqB,CAArB,IAA0BtC,CAAC,CAAC,CAAD,CAD5B,EAEP4B,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC,CAAD,CAAjB,CAAqB,CAArB,IAA0BtC,CAAC,CAAC,CAAD,CAF5B,CAAT;;AAIA,OAAK,IAAItB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG4D,iBAAiB,CAAC9D,MAAtC,EAA8CE,CAAC,EAA/C,EAAmD;AACjD,QAAI6D,CAAC,GAAG,CACNX,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC5D,CAAD,CAAjB,CAAqB,CAArB,IAA0BsB,CAAC,CAAC,CAAD,CAD7B,EAEN4B,EAAE,CAAC,CAAD,CAAF,GAAQU,iBAAiB,CAAC5D,CAAD,CAAjB,CAAqB,CAArB,IAA0BsB,CAAC,CAAC,CAAD,CAF7B,CAAR;AAIA,QAAIA,CAAC,GAAGC,IAAI,CAACsC,CAAD,EAAIE,EAAJ,CAAZ;;AACA,QAAIvC,GAAG,CAACF,CAAD,EAAIA,CAAJ,CAAH,GAAY,IAAhB,EAAsB;AACpB,WAAKoC,WAAL,CAAiBK,EAAjB,EAAqBF,CAArB,EAAwBT,MAAxB;AACA;AACD;AACF;;AACD,OAAKM,WAAL,CAAiBK,EAAjB,EAAqBA,EAArB,EAAyBX,MAAzB;AACD,CA9FD;;AAgGA1E,MAAM,CAAC0D,SAAP,CAAiBsB,WAAjB,GAA+B,UAAUR,EAAV,EAAcC,EAAd,EAAkBC,MAAlB,EAA0B;AACvDF,IAAE,GAAGhD,KAAK,CAACgD,EAAD,CAAV;AACAC,IAAE,GAAGjD,KAAK,CAACiD,EAAD,CAAV;AAEA,MAAI3C,KAAK,GAAG,CAAC,CAAC,CAAF,EAAK,CAAL,EAAQ,CAAR,CAAZ;AAEA,MAAIX,CAAC,GAAGW,KAAK,CAACV,MAAd;AACA,MAAIkE,EAAE,GAAGnE,CAAC,GAAGA,CAAb;AAEA,MAAItB,CAAC,GAAG,EAAR;AACAA,GAAC,CAAC,CAAD,CAAD,GAAO2E,EAAE,CAAC,CAAD,CAAT;AACA3E,GAAC,CAAC,CAAD,CAAD,GAAO2E,EAAE,CAAC,CAAD,CAAT;AAEA,MAAIe,OAAO,GAAG1C,IAAI,CAAC4B,EAAD,EAAKD,EAAL,CAAlB;AACA,MAAIgB,MAAM,GAAG,EAAb;AACAA,QAAM,CAAC,CAAD,CAAN,GAAY,CAACD,OAAO,CAAC,CAAD,CAApB;AACAC,QAAM,CAAC,CAAD,CAAN,GAAYD,OAAO,CAAC,CAAD,CAAnB;AAEAb,QAAM,CAAC7E,CAAD,EAAI6E,MAAM,CAACC,MAAX,EAAmB,IAAnB,CAAN;;AAEA,SAAO9E,CAAC,CAAC,CAAD,CAAD,KAAS4E,EAAE,CAAC,CAAD,CAAX,IAAkB5E,CAAC,CAAC,CAAD,CAAD,KAAS4E,EAAE,CAAC,CAAD,CAApC,EAAyC;AACvC,QAAIgB,IAAI,GAAGC,MAAM,CAACC,SAAlB;AACA,QAAIC,MAAM,GAAG,EAAb;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGP,EAApB,EAAwBO,CAAC,EAAzB,EAA6B;AAC3B,UAAIvE,CAAC,GAAGQ,KAAK,CAAC+D,CAAC,GAAG1E,CAAL,CAAb;AACA,UAAIS,CAAC,GAAGE,KAAK,CAACP,IAAI,CAACC,KAAL,CAAWqE,CAAC,GAAG1E,CAAf,CAAD,CAAb;AAEA,UAAI2E,KAAK,GAAGnD,GAAG,CAAC9C,CAAD,EAAI,CAACyB,CAAD,EAAIM,CAAJ,CAAJ,CAAf;AAEA,UAAIgB,CAAC,GAAGC,IAAI,CAACiD,KAAD,EAAQtB,EAAR,CAAZ;AACA,UAAIuB,CAAC,GAAGxE,IAAI,CAACyE,GAAL,CAASlD,GAAG,CAACF,CAAD,EAAI4C,MAAJ,CAAZ,IAA2B1C,GAAG,CAACF,CAAD,EAAI2C,OAAJ,CAAtC;;AACA,UAAIE,IAAI,GAAGM,CAAX,EAAc;AACZN,YAAI,GAAGM,CAAP;AACAH,cAAM,GAAG,CAACtE,CAAD,EAAIM,CAAJ,CAAT;AACD;AACF;;AAED/B,KAAC,GAAG8C,GAAG,CAAC9C,CAAD,EAAI+F,MAAJ,CAAP;AACAlB,UAAM,CAAC7E,CAAD,EAAI6E,MAAM,CAACC,MAAX,EAAmB,IAAnB,CAAN;AACD;;AACDD,QAAM,CAAC7E,CAAD,EAAI6E,MAAM,CAACC,MAAX,EAAmB,IAAnB,CAAN;AACD,CAzCD;;AA2CA3E,MAAM,CAAC0D,SAAP,CAAiBuC,WAAjB,GAA+B,UAC7BC,KAD6B,EAE7BxB,MAF6B,EAI7B;AAAA,MADAyB,YACA,uEADenG,MAAM,CAACoG,eACtB;AACA,MAAIC,QAAQ,GAAG,CACb,CAACX,MAAM,CAACC,SAAR,EAAmBD,MAAM,CAACC,SAA1B,CADa,EAEb,CAACD,MAAM,CAACY,SAAR,EAAmBZ,MAAM,CAACY,SAA1B,CAFa,CAAf;;AAIA,OAAK,IAAIhF,EAAC,GAAG,CAAb,EAAgBA,EAAC,GAAG4E,KAAK,CAAC9E,MAA1B,EAAkCE,EAAC,EAAnC,EAAuC;AACrC+E,YAAQ,CAAC,CAAD,CAAR,GAAcnD,GAAG,CAACgD,KAAK,CAAC5E,EAAD,CAAN,EAAW+E,QAAQ,CAAC,CAAD,CAAnB,CAAjB;AACAA,YAAQ,CAAC,CAAD,CAAR,GAAclD,GAAG,CAAC+C,KAAK,CAAC5E,EAAD,CAAN,EAAW+E,QAAQ,CAAC,CAAD,CAAnB,CAAjB;AACD;;AAED,MAAIrC,IAAI,GAAG,KAAKL,OAAL,EAAX;AACA,MAAI4C,WAAW,GAAG1D,IAAI,CAACmB,IAAD,EAAO,CAAC,CAAD,EAAI,CAAJ,CAAP,CAAtB;AACA,MAAIwC,KAAK,GAAG,CAAC,CAAD,EAAI,CAAJ,CAAZ;AACAH,UAAQ,CAAC,CAAD,CAAR,GAAc7E,KAAK,CAAC0B,GAAG,CAACqD,WAAD,EAAcpD,GAAG,CAACqD,KAAD,EAAQH,QAAQ,CAAC,CAAD,CAAhB,CAAjB,CAAJ,CAAnB;AACAA,UAAQ,CAAC,CAAD,CAAR,GAAc7E,KAAK,CAAC0B,GAAG,CAACqD,WAAD,EAAcpD,GAAG,CAACqD,KAAD,EAAQH,QAAQ,CAAC,CAAD,CAAhB,CAAjB,CAAJ,CAAnB;;AAEA,OAAK,IAAI/E,CAAC,GAAG+E,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAb,EAA6B/E,CAAC,GAAG+E,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAjC,EAAiD/E,CAAC,EAAlD,EAAsD;AACpD,SAAK,IAAIM,CAAC,GAAGyE,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAb,EAA6BzE,CAAC,GAAGyE,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAjC,EAAiDzE,CAAC,EAAlD,EAAsD;AACpD,UAAI/B,CAAC,GAAG,CAACyB,CAAD,EAAIM,CAAJ,CAAR;;AACA,UAAIuE,YAAY,CAACtG,CAAD,EAAIqG,KAAJ,CAAhB,EAA4B;AAC1BxB,cAAM,CAAC7E,CAAD,EAAIqG,KAAJ,EAAW,IAAX,CAAN;AACD;AACF;AACF;AACF,CA5BD;AA8BA;AACA;AACA;AACA;AACA;AACA;;;AACAlG,MAAM,CAAC0D,SAAP,CAAiB+C,YAAjB,GAAgC,UAAUjC,EAAV,EAAcC,EAAd,EAAkBiC,EAAlB,EAAsBhC,MAAtB,EAA8B;AAC5D,MAAIwB,KAAK,GAAG,CAAC1B,EAAD,EAAKC,EAAL,EAASiC,EAAT,CAAZ;AACA,OAAKT,WAAL,CAAiBC,KAAjB,EAAwBxB,MAAxB,EAAgC1E,MAAM,CAAC2G,cAAvC;AACD,CAHD;AAKA;AACA;AACA;AACA;AACA;AACA;;;AACA3G,MAAM,CAAC0D,SAAP,CAAiBkD,QAAjB,GAA4B,UAAUpC,EAAV,EAAcC,EAAd,EAAkBiC,EAAlB,EAAsBG,EAAtB,EAA0BnC,MAA1B,EAAkC;AAC5D,OAAKuB,WAAL,CAAiB,CAACzB,EAAD,EAAKC,EAAL,EAASiC,EAAT,EAAaG,EAAb,CAAjB,EAAmCnC,MAAnC;AACD,CAFD;;AAIA1E,MAAM,CAAC0D,SAAP,CAAiBoD,SAAjB,GAA6B,UAAUC,GAAV,EAAelH,CAAf,EAAkB;AAC7C,MAAI,aAAakH,GAAb,IAAoB,CAACA,GAAG,CAACC,OAA7B,EAAsC;AACtC,OAAKjD,YAAL,CAAkB,UAAC9D,MAAD;AAAA,WAAYA,MAAM,CAACE,GAAP,CAAW2G,SAAX,CAAqBC,GAArB,EAA0BlH,CAAC,CAAC,CAAD,CAA3B,EAAgCA,CAAC,CAAC,CAAD,CAAjC,CAAZ;AAAA,GAAlB;AACD,CAHD;;AAKAG,MAAM,CAAC0D,SAAP,CAAiBuD,UAAjB,GAA8B,UAAUpH,CAAV,EAAa4C,CAAb,EAAgBiC,MAAhB,EAAwB;AACpD,MAAIwC,MAAM,GAAG3E,KAAK,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAASE,CAAT,CAAlB;AACA,MAAI4D,QAAQ,GAAG,CAACxD,IAAI,CAAChD,CAAD,EAAIqH,MAAJ,CAAL,EAAkBvE,GAAG,CAAC9C,CAAD,EAAIqH,MAAJ,CAArB,CAAf;AACA,MAAIlD,IAAI,GAAG,KAAKL,OAAL,EAAX;AACA0C,UAAQ,CAAC,CAAD,CAAR,GAAc7E,KAAK,CAAC0B,GAAG,CAACL,IAAI,CAACmB,IAAD,EAAO,CAAC,CAAD,EAAI,CAAJ,CAAP,CAAL,EAAqBb,GAAG,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAASkD,QAAQ,CAAC,CAAD,CAAjB,CAAxB,CAAJ,CAAnB;AACAA,UAAQ,CAAC,CAAD,CAAR,GAAc7E,KAAK,CAAC0B,GAAG,CAACL,IAAI,CAACmB,IAAD,EAAO,CAAC,CAAD,EAAI,CAAJ,CAAP,CAAL,EAAqBb,GAAG,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAASkD,QAAQ,CAAC,CAAD,CAAjB,CAAxB,CAAJ,CAAnB;;AACA,OAAK,IAAI/E,CAAC,GAAG+E,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAb,EAA6B/E,CAAC,IAAI+E,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAlC,EAAkD/E,CAAC,EAAnD,EAAuD;AACrD,SAAK,IAAIM,CAAC,GAAGyE,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAb,EAA6BzE,CAAC,IAAIyE,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAlC,EAAkDzE,CAAC,EAAnD,EAAuD;AACrD,UAAIuD,CAAC,GAAG,CAAC7D,CAAD,EAAIM,CAAJ,CAAR;;AACA,UAAI,KAAKuF,cAAL,CAAoBhC,CAApB,EAAuBtF,CAAvB,EAA0B4C,CAA1B,CAAJ,EAAkC;AAChCiC,cAAM,CAACS,CAAD,EAAI,CAACtF,CAAD,EAAI4C,CAAJ,CAAJ,EAAY,IAAZ,CAAN;AACD;AACF;AACF;AACF,CAdD;;AAgBAzC,MAAM,CAAC0D,SAAP,CAAiByD,cAAjB,GAAkC,UAAUhC,CAAV,EAAatF,CAAb,EAAgB4C,CAAhB,EAAmB;AACnD,SAAOM,UAAU,CAACF,IAAI,CAACsC,CAAD,EAAItF,CAAJ,CAAL,CAAV,IAA0B4C,CAAC,GAAGA,CAArC;AACD,CAFD;;AAIAzC,MAAM,CAAC0D,SAAP,CAAiB0D,gBAAjB,GAAoC,UAAUC,GAAV,EAAenG,MAAf,EAAuBoG,UAAvB,EAAmC;AACrE,OAAKrH,MAAL,CAAYmH,gBAAZ,CAA6BC,GAA7B,EAAkCnG,MAAlC,EAA0CoG,UAA1C;AACD,CAFD;;AAIAtH,MAAM,CAAC0D,SAAP,CAAiB6D,UAAjB,GAA8B,UAAU1H,CAAV,EAAa2H,MAAb,EAAqBC,aAArB,EAAoC;AAChE,OAAK1D,YAAL,CAAkB,UAAC9D,MAAD,EAAY;AAC5BwH,iBAAa,CAACxH,MAAM,CAACE,GAAR,CAAb;AACAF,UAAM,CAACE,GAAP,CAAWuH,QAAX,CAAoBF,MAApB,EAA4B3H,CAAC,CAAC,CAAD,CAA7B,EAAkCA,CAAC,CAAC,CAAD,CAAnC;AACD,GAHD;AAID,CALD,C,CAOA;AAEA;;;AACAG,MAAM,CAACoG,eAAP,GAAyB,UAAUvG,CAAV,EAAaqG,KAAb,EAAoB;AAC3C,MAAItD,CAAC,GAAG,EAAR;AACA,MAAI+E,KAAK,GAAG,CAAZ;AACA,MAAIxG,CAAC,GAAG+E,KAAK,CAAC9E,MAAd;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,CAApB,EAAuBG,CAAC,EAAxB,EAA4B;AAC1BsB,KAAC,CAAC,CAAD,CAAD,GAAOC,IAAI,CAACqD,KAAK,CAAC,CAAC5E,CAAC,GAAG,CAAL,IAAUH,CAAX,CAAN,EAAqBtB,CAArB,CAAX;AACA+C,KAAC,CAAC,CAAD,CAAD,GAAOC,IAAI,CAACqD,KAAK,CAAC5E,CAAD,CAAN,EAAWzB,CAAX,CAAX;AACA8H,SAAK,IAAIpG,IAAI,CAACqG,IAAL,CAAU9E,GAAG,CAACF,CAAC,CAAC,CAAD,CAAF,EAAOA,CAAC,CAAC,CAAD,CAAR,CAAH,IAAmBI,IAAI,CAACJ,CAAC,CAAC,CAAD,CAAF,CAAJ,GAAaI,IAAI,CAACJ,CAAC,CAAC,CAAD,CAAF,CAApC,CAAV,CAAT;AACD;;AACD,SAAOrB,IAAI,CAACyE,GAAL,CAAS2B,KAAK,GAAG,IAAIpG,IAAI,CAACsG,EAA1B,IAAgC,IAAvC;AACD,CAVD;;AAYA7H,MAAM,CAAC2G,cAAP,GAAwB,UAAU9G,CAAV,EAAaqG,KAAb,EAAoB;AAC1C,MAAI4B,CAAC,GAAG5B,KAAK,CAAC9E,MAAd;AACA,MAAIwB,CAAC,GAAG,EAAR;AACA,MAAImF,KAAK,GAAG,EAAZ;;AACA,OAAK,IAAIzG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwG,CAApB,EAAuBxG,CAAC,EAAxB,EAA4B;AAC1BsB,KAAC,CAACtB,CAAD,CAAD,GAAOuB,IAAI,CAACqD,KAAK,CAAC,CAAC5E,CAAC,GAAG,CAAL,IAAUwG,CAAX,CAAN,EAAqB5B,KAAK,CAAC5E,CAAD,CAA1B,CAAX;AACA,QAAIH,CAAC,GAAG,CAAC,CAACyB,CAAC,CAACtB,CAAD,CAAD,CAAK,CAAL,CAAF,EAAWsB,CAAC,CAACtB,CAAD,CAAD,CAAK,CAAL,CAAX,CAAR;AACA,QAAImB,CAAC,GAAGI,IAAI,CAAChD,CAAD,EAAIqG,KAAK,CAAC5E,CAAD,CAAT,CAAZ;AACAyG,SAAK,CAACzG,CAAD,CAAL,GAAWwB,GAAG,CAACL,CAAD,EAAItB,CAAJ,CAAd;AACD;;AACD,MAAI6G,WAAW,GAAGpF,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,IAAUA,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,CAAV,GAAoBA,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,IAAUA,CAAC,CAAC,CAAD,CAAD,CAAK,CAAL,CAA9B,GAAwC,CAAxC,GAA4C,CAA5C,GAAgD,CAAC,CAAnE;;AACA,OAAK,IAAItB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwG,CAApB,EAAuBxG,CAAC,EAAxB,EAA4B;AAC1B,QAAI2G,KAAK,GAAGF,KAAK,CAACzG,CAAD,CAAL,GAAW0G,WAAvB;AACA,QAAIC,KAAK,GAAG,CAAZ,EAAe,OAAO,KAAP;AAChB;;AACD,SAAO,IAAP;AACD,CAhBD;;AAkBAjI,MAAM,CAACkI,YAAP,GAAsB,UAAUvH,KAAV,EAAiB;AACrC,SAAO,UAACd,CAAD,EAAIsI,OAAJ,EAAalI,MAAb;AAAA,WAAwBA,MAAM,CAACoE,OAAP,CAAexE,CAAf,EAAkBc,KAAlB,CAAxB;AAAA,GAAP;AACD,CAFD;;AAIAX,MAAM,CAACoI,WAAP,GAAqB,UAAUC,MAAV,EAAkB;AACrC,MAAIC,SAAS,GAAG,SAAZA,SAAY,CAACzI,CAAD,EAAI0I,IAAJ,EAAUtI,MAAV,EAAkBe,KAAlB,EAA4B;AAC1C,QAAIwH,iBAAiB,GAAG,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,CAAxB;;AACA,SAAK,IAAIlH,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiH,IAAI,CAACnH,MAAzB,EAAiCE,CAAC,EAAlC,EAAsC;AACpCkH,uBAAiB,CAAC,CAAD,CAAjB,GAAuBA,iBAAiB,CAAC,CAAD,CAAjB,GAAuBH,MAAM,CAAC/G,CAAD,CAAN,CAAU,CAAV,IAAeN,KAAK,CAACM,CAAD,CAAlE;AACAkH,uBAAiB,CAAC,CAAD,CAAjB,GAAuBA,iBAAiB,CAAC,CAAD,CAAjB,GAAuBH,MAAM,CAAC/G,CAAD,CAAN,CAAU,CAAV,IAAeN,KAAK,CAACM,CAAD,CAAlE;AACAkH,uBAAiB,CAAC,CAAD,CAAjB,GAAuBA,iBAAiB,CAAC,CAAD,CAAjB,GAAuBH,MAAM,CAAC/G,CAAD,CAAN,CAAU,CAAV,IAAeN,KAAK,CAACM,CAAD,CAAlE;AACAkH,uBAAiB,CAAC,CAAD,CAAjB,GAAuBA,iBAAiB,CAAC,CAAD,CAAjB,GAAuBH,MAAM,CAAC/G,CAAD,CAAN,CAAU,CAAV,IAAeN,KAAK,CAACM,CAAD,CAAlE;AACD;;AACDrB,UAAM,CAACoE,OAAP,CAAexE,CAAf,EAAkB2I,iBAAlB;AACD,GATD;;AAUA,SAAOxI,MAAM,CAACyI,yBAAP,CAAiCH,SAAjC,CAAP;AACD,CAZD;;AAcAtI,MAAM,CAAC0I,qBAAP,GAA+B,UAAUhE,MAAV,EAAkB;AAC/C,SAAO,UAAU7E,CAAV,EAAa8I,IAAb,EAAmB1I,MAAnB,EAA2B;AAChC,QAAI2I,EAAE,GAAG,CAACD,IAAI,CAAC,CAAD,CAAL,EAAUA,IAAI,CAAC,CAAD,CAAd,EAAmBA,IAAI,CAAC,CAAD,CAAvB,CAAT;AACA,QAAIE,EAAE,GAAG,CAACF,IAAI,CAAC,CAAD,CAAL,EAAUA,IAAI,CAAC,CAAD,CAAd,EAAmBA,IAAI,CAAC,CAAD,CAAvB,CAAT;AACA,QAAI3H,KAAK,GAAGhB,MAAM,CAAC8I,iBAAP,CAAyBjJ,CAAzB,EAA4B+I,EAA5B,CAAZ;;AACA,QACE5H,KAAK,CAAC,CAAD,CAAL,GAAW,CAAX,IACAA,KAAK,CAAC,CAAD,CAAL,GAAW,CADX,IAEAA,KAAK,CAAC,CAAD,CAAL,GAAW,CAFX,IAGAO,IAAI,CAACyE,GAAL,CAAShF,KAAK,CAAC,CAAD,CAAL,GAAWA,KAAK,CAAC,CAAD,CAAhB,GAAsBA,KAAK,CAAC,CAAD,CAA3B,GAAiC,CAA1C,IAA+C,KAJjD,EAKE;AACA0D,YAAM,CAAC7E,CAAD,EAAI8I,IAAJ,EAAU1I,MAAV,EAAkB,CAACe,KAAK,CAAC,CAAD,CAAN,EAAWA,KAAK,CAAC,CAAD,CAAhB,EAAqBA,KAAK,CAAC,CAAD,CAA1B,EAA+B,CAA/B,CAAlB,CAAN;AACD,KAPD,MAOO;AACLA,WAAK,GAAGhB,MAAM,CAAC8I,iBAAP,CAAyBjJ,CAAzB,EAA4BgJ,EAA5B,CAAR;AACAnE,YAAM,CAAC7E,CAAD,EAAI8I,IAAJ,EAAU1I,MAAV,EAAkB,CAACe,KAAK,CAAC,CAAD,CAAN,EAAW,CAAX,EAAcA,KAAK,CAAC,CAAD,CAAnB,EAAwBA,KAAK,CAAC,CAAD,CAA7B,CAAlB,CAAN;AACD;AACF,GAfD;AAgBD,CAjBD;;AAmBAhB,MAAM,CAACyI,yBAAP,GAAmC,UAAU/D,MAAV,EAAkB;AACnD,SAAO,UAAC7E,CAAD,EAAIkJ,QAAJ,EAAc9I,MAAd,EAAyB;AAC9B,QAAMe,KAAK,GAAGhB,MAAM,CAAC8I,iBAAP,CAAyBjJ,CAAzB,EAA4BkJ,QAA5B,CAAd;AACArE,UAAM,CAAC7E,CAAD,EAAIkJ,QAAJ,EAAc9I,MAAd,EAAsBe,KAAtB,CAAN;AACD,GAHD;AAID,CALD;;AAOAhB,MAAM,CAACgJ,qBAAP,GAA+B,UAAUtE,MAAV,EAAkB;AAC/C,SAAO,UAAC7E,CAAD,EAAIoJ,IAAJ,EAAUhJ,MAAV,EAAqB;AAC1B,QAAI2C,CAAC,GAAGC,IAAI,CAACoG,IAAI,CAAC,CAAD,CAAL,EAAUA,IAAI,CAAC,CAAD,CAAd,CAAZ;AACA,QAAI3F,CAAC,GAAGT,IAAI,CAAChD,CAAD,EAAIoJ,IAAI,CAAC,CAAD,CAAR,CAAZ;AACA,QAAIC,KAAK,GAAGnG,UAAU,CAACH,CAAD,CAAtB;AACA,QAAIuG,UAAU,GAAGrG,GAAG,CAACQ,CAAD,EAAIV,CAAJ,CAApB;AACA,QAAIwG,CAAC,GAAGF,KAAK,IAAI,GAAT,GAAe,CAAf,GAAmBC,UAAU,GAAGD,KAAxC;AACAxE,UAAM,CAAC7E,CAAD,EAAIoJ,IAAJ,EAAUhJ,MAAV,EAAkBmJ,CAAlB,CAAN;AACD,GAPD;AAQD,CATD;AAWA;AACA;AACA;AACA;;;AACApJ,MAAM,CAACqJ,iBAAP,GAA2B,UACzBtC,GADyB,EAEzBuC,YAFyB,EAIzB;AAAA,MADAC,aACA,uEADgBvJ,MAAM,CAACwJ,qBACvB;AACA,MAAIC,UAAU,GAAG,IAAjB;;AACA,MAAMC,WAAW,GAAG,SAAdA,WAAc,CAAC7J,CAAD,EAAI8I,IAAJ,EAAU1I,MAAV,EAAkBe,KAAlB,EAA4B;AAC9C,QAAI,CAAC+F,GAAG,CAACC,OAAL,IAAgByC,UAAU,IAAI,IAAlC,EACEA,UAAU,GAAG,IAAIzJ,MAAJ,CAAW2J,gDAAO,CAACC,cAAR,CAAuB7C,GAAvB,CAAX,CAAb;AACF,QAAM8C,WAAW,GAAGJ,UAApB;AACA,QAAMK,OAAO,GAAGD,WAAW,CAAClG,OAAZ,EAAhB;AACA,QAAMoG,mBAAmB,GAAG,CAAC,CAAD,EAAI,CAAJ,CAA5B;;AACA,SAAK,IAAIzI,GAAC,GAAG,CAAb,EAAgBA,GAAC,GAAGgI,YAAY,CAAClI,MAAjC,EAAyCE,GAAC,EAA1C,EAA8C;AAC5CyI,yBAAmB,CAAC,CAAD,CAAnB,GACEA,mBAAmB,CAAC,CAAD,CAAnB,GAAyBT,YAAY,CAAChI,GAAD,CAAZ,CAAgB,CAAhB,IAAqBN,KAAK,CAACM,GAAD,CADrD;AAEAyI,yBAAmB,CAAC,CAAD,CAAnB,GACEA,mBAAmB,CAAC,CAAD,CAAnB,GAAyBT,YAAY,CAAChI,GAAD,CAAZ,CAAgB,CAAhB,IAAqBN,KAAK,CAACM,GAAD,CADrD;AAED;;AACD,QAAIA,CAAC,GAAG,CACN,CAAC,IAAIyI,mBAAmB,CAAC,CAAD,CAAxB,KAAgCD,OAAO,CAAC,CAAD,CAAP,GAAa,CAA7C,CADM,EAEN,CAACA,OAAO,CAAC,CAAD,CAAP,GAAa,CAAd,IAAmBC,mBAAmB,CAAC,CAAD,CAFhC,CAAR,CAZ8C,CAgB9C;;AACAzI,KAAC,GAAG6B,GAAG,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,EAASD,GAAG,CAACL,IAAI,CAAC,CAACiH,OAAO,CAAC,CAAD,CAAR,EAAaA,OAAO,CAAC,CAAD,CAApB,CAAD,EAA2B,CAAC,CAAD,EAAI,CAAJ,CAA3B,CAAL,EAAyCxI,CAAzC,CAAZ,CAAP,CAjB8C,CAkB9C;;AACA,QAAIM,CAAC,GAAGJ,KAAK,CAACF,CAAD,CAAb;AACA,QAAI0I,YAAY,GAAG,CACjBH,WAAW,CAACzF,MAAZ,CAAmBxC,CAAnB,CADiB,EAEjBiI,WAAW,CAACzF,MAAZ,CAAmBzB,GAAG,CAACf,CAAD,EAAI,CAAC,CAAD,EAAI,CAAJ,CAAJ,CAAtB,CAFiB,EAGjBiI,WAAW,CAACzF,MAAZ,CAAmBzB,GAAG,CAACf,CAAD,EAAI,CAAC,CAAD,EAAI,CAAJ,CAAJ,CAAtB,CAHiB,EAIjBiI,WAAW,CAACzF,MAAZ,CAAmBzB,GAAG,CAACf,CAAD,EAAI,CAAC,CAAD,EAAI,CAAJ,CAAJ,CAAtB,CAJiB,CAAnB;AAMA,QAAIqI,UAAU,GAAGV,aAAa,CAACS,YAAD,EAAenH,IAAI,CAACvB,CAAD,EAAIM,CAAJ,CAAnB,CAA9B;AACA3B,UAAM,CAACoE,OAAP,CAAexE,CAAf,EAAkBoK,UAAlB;AACD,GA5BD;;AA6BA,SAAOjK,MAAM,CAAC0I,qBAAP,CAA6BgB,WAA7B,CAAP;AACD,CApCD;;AAsCA1J,MAAM,CAACkK,aAAP,GAAwB,YAAM;AAC5B,MAAMC,OAAO,GAAG,EAAhB;AACA,MAAMnG,IAAI,GAAG,CAAb;AACA,SAAO;AACLoG,aAAS,EAAE,mBAACC,YAAD;AAAA,aAAkBF,OAAO,CAACE,YAAY,GAAGrG,IAAhB,CAAP,IAAgClE,SAAlD;AAAA,KADN;AAELwK,OAAG,EAAE,aAACD,YAAD;AAAA,aAAkBF,OAAO,CAACE,YAAY,GAAGrG,IAAhB,CAAzB;AAAA,KAFA;AAGLuG,OAAG,EAAE,aAACF,YAAD,EAAeG,KAAf;AAAA,aAA0BL,OAAO,CAACE,YAAY,GAAGrG,IAAhB,CAAP,GAA+BwG,KAAzD;AAAA;AAHA,GAAP;AAKD,CARsB,EAAvB,C,CAQM;;;AAENxK,MAAM,CAACqK,YAAP,GAAsB,UAACtB,QAAD,EAAc;AAClC,MAAM7C,KAAK,GAAG,CACZ6C,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CADY,EAEZA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAFY,EAGZA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAHY,EAIZA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAJY,EAKZA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CALY,EAMZA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CANY,CAAd;AAQA,SAAO7C,KAAK,CAACuE,MAAN,CAAa,UAACpH,CAAD,EAAIxD,CAAJ;AAAA,WAAU,KAAKwD,CAAL,GAASxD,CAAnB;AAAA,GAAb,EAAmC,CAAnC,CAAP;AACD,CAVD;;AAYAG,MAAM,CAAC8I,iBAAP,GAA2B,UAAUjJ,CAAV,EAAakJ,QAAb,EAAuB;AAChD,MAAM2B,IAAI,GAAG1K,MAAM,CAACqK,YAAP,CAAoBtB,QAApB,CAAb;AACA,MAAMtH,CAAC,GAAG,CAAC5B,CAAC,CAAC,CAAD,CAAD,GAAOkJ,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAAR,EAAwBlJ,CAAC,CAAC,CAAD,CAAD,GAAOkJ,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAA/B,CAAV;;AACA,MAAI,CAAC/I,MAAM,CAACkK,aAAP,CAAqBE,SAArB,CAA+BM,IAA/B,CAAL,EAA2C;AACzC,QAAMlI,EAAC,GAAG,CACRuG,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,IAAiBA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CADT,EAERA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,IAAiBA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAFT,CAAV;AAIA,QAAMnG,EAAC,GAAG,CACRmG,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,IAAiBA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CADT,EAERA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,IAAiBA,QAAQ,CAAC,CAAD,CAAR,CAAY,CAAZ,CAFT,CAAV;;AAIA,QAAM4B,IAAG,GAAGnI,EAAC,CAAC,CAAD,CAAD,GAAOI,EAAC,CAAC,CAAD,CAAR,GAAcJ,EAAC,CAAC,CAAD,CAAD,GAAOI,EAAC,CAAC,CAAD,CAAlC;;AACA5C,UAAM,CAACkK,aAAP,CAAqBK,GAArB,CAAyBG,IAAzB,EAA+B;AAC7B3B,cAAQ,EAAEA,QADmB;AAE7BvG,OAAC,EAAEA,EAAC,CAACoI,GAAF,CAAM,UAAC/K,CAAD;AAAA,eAAOA,CAAC,GAAG8K,IAAX;AAAA,OAAN,CAF0B;AAG7B/H,OAAC,EAAEA,EAAC,CAACgI,GAAF,CAAM,UAAC/K,CAAD;AAAA,eAAOA,CAAC,GAAG8K,IAAX;AAAA,OAAN,CAH0B;AAI7BA,SAAG,EAAEA,IAJwB;AAK7BD,UAAI,EAAEA;AALuB,KAA/B;AAOD;;AACD,MAAMG,KAAK,GAAG7K,MAAM,CAACkK,aAAP,CAAqBI,GAArB,CAAyBI,IAAzB,CAAd;AACA,MAAMlI,CAAC,GAAGqI,KAAK,CAACrI,CAAhB;AACA,MAAMI,CAAC,GAAGiI,KAAK,CAACjI,CAAhB;AACA,MAAM+H,GAAG,GAAGE,KAAK,CAACF,GAAlB;AACA,MAAIA,GAAG,IAAI,CAAX,EAAc,OAAO,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAP;AACd,MAAI3J,KAAK,GAAG,CAAC4B,CAAC,CAAC,CAAD,CAAD,GAAOnB,CAAC,CAAC,CAAD,CAAR,GAAcmB,CAAC,CAAC,CAAD,CAAD,GAAOnB,CAAC,CAAC,CAAD,CAAvB,EAA4Be,CAAC,CAAC,CAAD,CAAD,GAAOf,CAAC,CAAC,CAAD,CAAR,GAAce,CAAC,CAAC,CAAD,CAAD,GAAOf,CAAC,CAAC,CAAD,CAAlD,CAAZ;AACA,SAAO,CAAC,IAAIT,KAAK,CAAC,CAAD,CAAT,GAAeA,KAAK,CAAC,CAAD,CAArB,EAA0BA,KAAK,CAAC,CAAD,CAA/B,EAAoCA,KAAK,CAAC,CAAD,CAAzC,CAAP;AACD,CA5BD;AA8BA;AACA;AACA;AACA;;;AACAhB,MAAM,CAACwJ,qBAAP,GAA+B,UAAUsB,MAAV,EAAkBjL,CAAlB,EAAqB;AAClD,MAAIkL,GAAG,GAAG,EAAV;;AACA,OAAK,IAAIlF,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGiF,MAAM,CAAC1J,MAA3B,EAAmCyE,CAAC,EAApC,EAAwC;AACtC,QAAImF,GAAG,GAAGF,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,IAAe,CAACiF,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,IAAeiF,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,CAAhB,IAAgChG,CAAC,CAAC,CAAD,CAA1D;AACA,QAAIoL,GAAG,GAAGH,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,IAAe,CAACiF,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,IAAeiF,MAAM,CAAC,CAAD,CAAN,CAAUjF,CAAV,CAAhB,IAAgChG,CAAC,CAAC,CAAD,CAA1D;AACA,QAAIkG,CAAC,GAAGiF,GAAG,GAAG,CAACC,GAAG,GAAGD,GAAP,IAAcnL,CAAC,CAAC,CAAD,CAA7B;AACAkL,OAAG,CAAClG,IAAJ,CAASkB,CAAT;AACD;;AACD,SAAOgF,GAAP;AACD,CATD;AAUA;AACA;AACA;AACA;AACA;AACA;;;AACA/K,MAAM,CAACkL,YAAP,GAAsB,UAAUlH,IAAV,EAAgBmH,KAAhB,EAAuB;AAC3C,MAAMlL,MAAM,GAAGgC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf;AACAjC,QAAM,CAACqC,YAAP,CAAoB,OAApB,EAA6B0B,IAAI,CAAC,CAAD,CAAjC;AACA/D,QAAM,CAACqC,YAAP,CAAoB,QAApB,EAA8B0B,IAAI,CAAC,CAAD,CAAlC;AACA/B,UAAQ,CAACmJ,cAAT,CAAwBD,KAAxB,EAA+BE,WAA/B,CAA2CpL,MAA3C;AACA,SAAOA,MAAP;AACD,CAND;;AAQeD,qEAAf,E;;;;;;;;;;;;AChnBA;AAAA;CAEA;AAEA;;AACA,IAAIsL,QAAQ,GAAG,SAAXA,QAAW,CAAUrL,MAAV,EAAkBsL,WAAlB,EAA+B;AAC5CvL,iDAAM,CAACwL,IAAP,CAAY,IAAZ,EAAkBvL,MAAlB;;AACA,MACEsL,WAAW,CAACnK,MAAZ,IAAsB,CAAtB,IACCmK,WAAW,CAAC,CAAD,CAAX,CAAenK,MAAf,IAAyB,CAAzB,IAA8BmK,WAAW,CAAC,CAAD,CAAX,CAAenK,MAAf,IAAyB,CAF1D,EAGE;AACA,UAAM,6EAAN;AACD;;AACD,OAAKmK,WAAL,GAAmBA,WAAnB;AACD,CATD;;AAWAD,QAAQ,CAAC5H,SAAT,GAAqB+H,MAAM,CAACC,MAAP,CAAc1L,+CAAM,CAAC0D,SAArB,CAArB;AACA4H,QAAQ,CAAC5H,SAAT,CAAmBiI,WAAnB,GAAiCL,QAAjC;AAEA;AACA;AACA;;AACAA,QAAQ,CAAC5H,SAAT,CAAmBkI,gBAAnB,GAAsC,UAAU/L,CAAV,EAAa;AACjD,MAAIgM,IAAI,GACL,EAAE,KAAK5L,MAAL,CAAYO,MAAZ,GAAqB,CAAvB,KACE,KAAK+K,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IAAyB,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAD3B,CAAD,IAEC1L,CAAC,CAAC,CAAD,CAAD,GAAO,KAAK0L,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAFR,CADF;AAIA,MAAIO,IAAI,GACL,CAAC,KAAK7L,MAAL,CAAYM,KAAZ,GAAoB,CAArB,KACE,KAAKgL,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IAAyB,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAD3B,CAAD,IAEC1L,CAAC,CAAC,CAAD,CAAD,GAAO,KAAK0L,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAFR,CADF;AAIA,SAAO,CAACM,IAAD,EAAOC,IAAP,CAAP;AACD,CAVD;AAYA;AACA;AACA;;;AACAR,QAAQ,CAAC5H,SAAT,CAAmBqI,gBAAnB,GAAsC,UAAUlM,CAAV,EAAa;AACjD,MAAImM,EAAE,GACJ,KAAKT,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IACC,CAAC,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IAAyB,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAA1B,KACE,KAAKtL,MAAL,CAAYM,KAAZ,GAAoB,CADtB,CAAD,GAEEV,CAAC,CAAC,CAAD,CAJL;AAKA,MAAIoM,EAAE,GACJ,KAAKV,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IACC,CAAC,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,IAAyB,KAAKA,WAAL,CAAiB,CAAjB,EAAoB,CAApB,CAA1B,KACE,KAAKtL,MAAL,CAAYO,MAAZ,GAAqB,CADvB,CAAD,GAEEX,CAAC,CAAC,CAAD,CAJL;AAKA,SAAO,CAACmM,EAAD,EAAKC,EAAL,CAAP;AACD,CAZD;AAcA;AACA;AACA;AACA;;;AACAX,QAAQ,CAAC5H,SAAT,CAAmBa,QAAnB,GAA8B,UAAUC,EAAV,EAAcC,EAAd,EAAkBC,MAAlB,EAA0B;AACtD,MAAMwH,EAAE,GAAG,KAAKN,gBAAL,CAAsBpH,EAAtB,CAAX;AACA,MAAM2H,EAAE,GAAG,KAAKP,gBAAL,CAAsBnH,EAAtB,CAAX;AACAzE,iDAAM,CAAC0D,SAAP,CAAiBa,QAAjB,CAA0BiH,IAA1B,CAA+B,IAA/B,EAAqCU,EAArC,EAAyCC,EAAzC,EAA6CzH,MAA7C;AACD,CAJD;AAMA;AACA;AACA;AACA;AACA;;;AACA4G,QAAQ,CAAC5H,SAAT,CAAmB+C,YAAnB,GAAkC,UAAUjC,EAAV,EAAcC,EAAd,EAAkBiC,EAAlB,EAAsBhC,MAAtB,EAA8B;AAC9D,MAAMwH,EAAE,GAAG,KAAKN,gBAAL,CAAsBpH,EAAtB,CAAX;AACA,MAAM2H,EAAE,GAAG,KAAKP,gBAAL,CAAsBnH,EAAtB,CAAX;AACA,MAAM2H,EAAE,GAAG,KAAKR,gBAAL,CAAsBlF,EAAtB,CAAX;AACA1G,iDAAM,CAAC0D,SAAP,CAAiB+C,YAAjB,CAA8B+E,IAA9B,CAAmC,IAAnC,EAAyCU,EAAzC,EAA6CC,EAA7C,EAAiDC,EAAjD,EAAqD1H,MAArD;AACD,CALD;AAOA;AACA;AACA;AACA;AACA;AACA;;;AACA4G,QAAQ,CAAC5H,SAAT,CAAmBkD,QAAnB,GAA8B,UAAUpC,EAAV,EAAcC,EAAd,EAAkBiC,EAAlB,EAAsBG,EAAtB,EAA0BnC,MAA1B,EAAkC;AAC9D,MAAMwH,EAAE,GAAG,KAAKN,gBAAL,CAAsBpH,EAAtB,CAAX;AACA,MAAM2H,EAAE,GAAG,KAAKP,gBAAL,CAAsBnH,EAAtB,CAAX;AACA,MAAM2H,EAAE,GAAG,KAAKR,gBAAL,CAAsBlF,EAAtB,CAAX;AACA,MAAM2F,EAAE,GAAG,KAAKT,gBAAL,CAAsB/E,EAAtB,CAAX;AACA7G,iDAAM,CAAC0D,SAAP,CAAiBkD,QAAjB,CAA0B4E,IAA1B,CAA+B,IAA/B,EAAqCU,EAArC,EAAyCC,EAAzC,EAA6CC,EAA7C,EAAiDC,EAAjD,EAAqD3H,MAArD;AACD,CAND;;AAQA4G,QAAQ,CAAC5H,SAAT,CAAmBuD,UAAnB,GAAgC,UAAUpH,CAAV,EAAa4C,CAAb,EAAgBiC,MAAhB,EAAwB;AACtD;AACA,MAAMjD,CAAC,GAAG,KAAKmK,gBAAL,CAAsB/L,CAAtB,CAAV;AACA,MAAMyD,CAAC,GAAG,KAAKsI,gBAAL,CAAsB,CAACnJ,CAAD,EAAI,CAAJ,CAAtB,EAA8B,CAA9B,IAAmC,KAAKmJ,gBAAL,CAAsB,CAAC,CAAD,EAAI,CAAJ,CAAtB,EAA8B,CAA9B,CAA7C;AACA5L,iDAAM,CAAC0D,SAAP,CAAiBuD,UAAjB,CAA4BuE,IAA5B,CAAiC,IAAjC,EAAuC/J,CAAvC,EAA0C6B,CAA1C,EAA6CoB,MAA7C;AACD,CALD;;AAOA4G,QAAQ,CAAC5H,SAAT,CAAmBoD,SAAnB,GAA+B,UAAUC,GAAV,EAAelH,CAAf,EAAkB;AAC/CG,iDAAM,CAAC0D,SAAP,CAAiBoD,SAAjB,CAA2B0E,IAA3B,CAAgC,IAAhC,EAAsCzE,GAAtC,EAA2C,KAAK6E,gBAAL,CAAsB/L,CAAtB,CAA3C;AACD,CAFD;;AAIAyL,QAAQ,CAAC5H,SAAT,CAAmB6D,UAAnB,GAAgC,UAAU1H,CAAV,EAAa2H,MAAb,EAAqBC,aAArB,EAAoC;AAClE,MAAMhG,CAAC,GAAG,KAAKmK,gBAAL,CAAsB/L,CAAtB,CAAV;AACAG,iDAAM,CAAC0D,SAAP,CAAiB6D,UAAjB,CAA4BiE,IAA5B,CAAiC,IAAjC,EAAuC/J,CAAvC,EAA0C+F,MAA1C,EAAkDC,aAAlD;AACD,CAHD,C,CAKA;;;AACA6D,QAAQ,CAAC5H,SAAT,CAAmB4I,SAAnB,GAA+B,UAAUC,MAAV,EAAkB;AAC/C,MAAIA,MAAM,CAACnL,MAAP,IAAiB,CAAjB,IAAuBmL,MAAM,CAAC,CAAD,CAAN,CAAUnL,MAAV,IAAoB,CAApB,IAAyBmL,MAAM,CAAC,CAAD,CAAN,CAAUnL,MAAV,IAAoB,CAAxE,EAA4E;AAC1E,UAAM,6EAAN;AACD;;AACD,OAAKmK,WAAL,GAAmBgB,MAAnB;AACD,CALD;;AAOejB,uEAAf,E;;;;;;;;;;;;AC/GA;AAAA,IAAM3B,OAAO,GAAG,CACd;AADc,CAAhB;AAIA;AACA;AACA;;AACAA,OAAO,CAACC,cAAR,GAAyB,UAAA7C,GAAG,EAAI;AAC9B,MAAMyF,SAAS,GAAGvK,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAlB;AACAsK,WAAS,CAACjM,KAAV,GAAkBwG,GAAG,CAACxG,KAAtB;AACAiM,WAAS,CAAChM,MAAV,GAAmBuG,GAAG,CAACvG,MAAvB;AACA,MAAMiM,UAAU,GAAGD,SAAS,CAACpM,UAAV,CAAqB,IAArB,CAAnB;AACAqM,YAAU,CAAC7L,SAAX,GAAuB,kBAAvB;AACA6L,YAAU,CAACxI,wBAAX,GAAsC,aAAtC;AACAwI,YAAU,CAACxL,QAAX,CAAoB,CAApB,EAAuB,CAAvB,EAA0BuL,SAAS,CAACjM,KAApC,EAA2CiM,SAAS,CAAChM,MAArD;AACAiM,YAAU,CAAC3F,SAAX,CAAqBC,GAArB,EAA0B,CAA1B,EAA6B,CAA7B;AACA,SAAOyF,SAAP;AACD,CAVD;AAYA;AACA;AACA;;;AACA7C,OAAO,CAAC+C,gBAAR,GAA2B,UAAA3F,GAAG,EAAI;AAChC9G,QAAM,GAAG0J,OAAO,CAACC,cAAR,CAAuB7C,GAAvB,CAAT;AACA,SAAO9G,MAAM,CAACG,UAAP,CAAkB,IAAlB,EAAwBE,YAAxB,CAAqC,CAArC,EAAwC,CAAxC,EAA2CyG,GAAG,CAACxG,KAA/C,EAAsDwG,GAAG,CAACvG,MAA1D,CAAP;AACD,CAHD;;AAKAmJ,OAAO,CAACgD,SAAR,GAAoB,UAAAC,GAAG,EAAI;AACzB,MAAM7F,GAAG,GAAG,IAAI8F,KAAJ,EAAZ;AACA9F,KAAG,CAAC6F,GAAJ,GAAUA,GAAV;AACA7F,KAAG,CAACC,OAAJ,GAAc,KAAd;;AACAD,KAAG,CAAC+F,MAAJ,GAAa;AAAA,WAAO/F,GAAG,CAACC,OAAJ,GAAc,IAArB;AAAA,GAAb;;AACA,SAAOD,GAAP;AACD,CAND;;AAQA4C,OAAO,CAACoD,2BAAR,GAAsC,UAAAhG,GAAG;AAAA,SAAI;AAAA,WAAMA,GAAG,CAACC,OAAV;AAAA,GAAJ;AAAA,CAAzC;;AAEe2C,sEAAf,E;;;;;;;;;;;;;;;;;;;;;ICrCqBjI,K;AACnB;AACF;AACA;AACA;AACE,iBAAYoC,IAAZ,EAAkB;AAAA;;AAChB,SAAKA,IAAL,GAAYA,IAAZ;AACD;;;;WAED,mBAAU;AACR,aAAO,KAAKA,IAAZ;AACD;;;SAgBD,eAAU;AACR,aAAO,KAAKA,IAAL,CAAU,CAAV,CAAP;AACD;;;SAED,eAAY;AACV,aAAO,KAAKA,IAAL,CAAU,CAAV,CAAP;AACD;;;SAED,eAAW;AACT,aAAO,KAAKA,IAAL,CAAU,CAAV,CAAP;AACD;;;SAED,eAAY;AACV,aAAO,KAAKA,IAAL,CAAU,CAAV,CAAP;AACD;;;WA5BD,kBAAyD;AAAA,UAA3CjD,GAA2C,uEAArC,CAAqC;AAAA,UAAlCC,KAAkC,uEAA1B,CAA0B;AAAA,UAAvBC,IAAuB,uEAAhB,CAAgB;AAAA,UAAbC,KAAa,uEAAL,GAAK;AACvD,UAAM8C,IAAI,GAAG,IAAIkJ,UAAJ,CAAe,CAAf,CAAb;AACAlJ,UAAI,CAAC,CAAD,CAAJ,GAAUjD,GAAV;AACAiD,UAAI,CAAC,CAAD,CAAJ,GAAUhD,KAAV;AACAgD,UAAI,CAAC,CAAD,CAAJ,GAAU/C,IAAV;AACA+C,UAAI,CAAC,CAAD,CAAJ,GAAU9C,KAAV;AACA,aAAO,IAAIU,KAAJ,CAAUoC,IAAV,CAAP;AACD;;;WAED,kBAAgB;AACd,UAAMrB,CAAC,GAAG,SAAJA,CAAI;AAAA,eAAMlB,IAAI,CAAC0L,MAAL,KAAgB,GAAtB;AAAA,OAAV;;AACA,aAAOvL,KAAK,CAACC,MAAN,CAAac,CAAC,EAAd,EAAkBA,CAAC,EAAnB,EAAuBA,CAAC,EAAxB,EAA4BA,CAAC,EAA7B,CAAP;AACD;;;;;;;;;;;;;;;;;;ACzBH;AAAA;AAAA;AAAA,IAAMyK,UAAU,GAAG,EAAnB;AAEAA,UAAU,CAACC,WAAX,GAAyB;AACvBH,YAAU,EAAE;AAAA,sCAAI9G,KAAJ;AAAIA,WAAJ;AAAA;;AAAA,WAAckH,iBAAiB,CAAClH,KAAD,CAA/B;AAAA;AADW,CAAzB;AAIA;AAEO,IAAMmH,IAAI,GAAG,SAAPA,IAAO,CAACnM,MAAD,EAAY;AAC9B,MAAMkI,CAAC,GAAGkE,WAAW,CAACC,GAAZ,EAAV;AACArM,QAAM;AACN,SAAOoM,WAAW,CAACC,GAAZ,KAAoBnE,CAA3B;AACD,CAJM;;AAMP,SAASgE,iBAAT,CAA2BlH,KAA3B,EAAkC;AAChC,MAAMsH,MAAM,GAAG,IAAIR,UAAJ,CAAe9G,KAAK,CAAC9E,MAArB,CAAf;;AACA,OAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGkM,MAAM,CAACpM,MAA3B,EAAmCE,CAAC,EAApC,EAAwC;AACtCkM,UAAM,CAAClM,CAAD,CAAN,GAAY4E,KAAK,CAAC5E,CAAD,CAAjB;AACD;;AACD,SAAOkM,MAAP;AACD,C;;;;;;;;;;;;ACpBD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACNA,sE;;;;;;;;;;;ACAA,mE;;;;;;;;;;;ACAA,sE;;;;;;;;;;;ACAA,sE;;;;;;;;;;;ACAA,gE;;;;;;;;;;;ACAA,iF;;;;;;;;;;;ACAA,uE","file":"index.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default class Animator {\n  constructor(state, next, doWhile) {\n    this.state = state;\n    this.next = next;\n    this.while = doWhile;\n    this.requestAnimeId = null;\n  }\n\n  play() {\n    this.requestAnimeId = requestAnimationFrame(() => {\n      if (!this.while(this.state)) return this.stop();\n      this.state = this.next(this.state);\n      this.play();\n    });\n    return this;\n  }\n\n  stop() {\n    cancelAnimationFrame(this.requestAnimeId);\n    return this;\n  }\n\n  static builder() {\n    return new AnimatorBuilder();\n  }\n}\n\nclass AnimatorBuilder {\n  constructor() {\n    this._state = null;\n    this._next = null;\n    this._end = null;\n  }\n\n  initialState(state) {\n    this._state = state;\n    return this;\n  }\n\n  nextState(next) {\n    this._next = next;\n    return this;\n  }\n\n  while(end) {\n    this._end = end;\n    return this;\n  }\n\n  build() {\n    const someAreEmpty = [this._state, this._next, this._end].some(\n      (x) => x === null || x === undefined\n    );\n    if (someAreEmpty) throw new Error(\"Animator properties are missing\");\n    return new Animator(this._state, this._next, this._end);\n  }\n}\n","import Color from \"../../Color/main/Color\";\n\n/*\n Canvas coordinates\n\n 0                  W-1\n +-------------> y\n |\n |\n |       *\n |\n |\n v x\n\n H-1\n */\n\n/*\n\nThe point xe_1 + ye_2 corresponds to a point in the middle of a pxl.\n\nThe canvas data is an array of length colors(C) * width(W) * height(H). Is a 3D-array.\nThe index is a number in [0, C * W * H - 1].\nHaving (x, y, z) where z is the color axis, the formula to index the array is :\n\nf(x, y, z) = C * W * x + C * y + z.\n\nWhere x in [0, H - 1], y in [0, W - 1] and z in [0, C - 1].\n\nNote that f(H - 1, W - 1, C - 1) = C * W * H - 1.\n*/\n\nexport default class Canvas {\n  /**\n   *\n   * @param {*} canvas: DOM element of type canvas\n   */\n  constructor(canvas) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext(\"2d\");\n    this.image = this.ctx.getImageData(0, 0, canvas.width, canvas.height);\n    // width * height * 4 array of integers\n    this.imgBuffer = this.image.data;\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getDom = this.getCanvas;\n\n  //========================================================================================\n  /*                                                                                      *\n   *                                 side effects function                                *\n   *                                                                                      */\n  //========================================================================================\n\n  /**\n   * Update color of canvas\n   * @param {*} color: Color\n   */\n  fill(color) {\n    this.ctx.fillStyle = `rgba(${color.red}, ${color.green}, ${color.blue}, ${\n      color.alpha / 255.0\n    })`;\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    this.image = this.ctx.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n    this.imgBuffer = this.image.data;\n    return this;\n  }\n\n  /**\n   *\n   * @param {*} lambda: (Color,x:number,y:number) => Color\n   */\n  map(lambda = () => {}) {\n    const n = this.imgBuffer.length;\n    const { width: w } = this.canvas;\n    for (let i = 0; i < n; i += 4) {\n      const x = Math.floor(i / (4 * w));\n      const y = Math.floor(i / 4) % w;\n      const color = lambda(\n        Color.ofRGBA(\n          this.imgBuffer[i],\n          this.imgBuffer[i + 1],\n          this.imgBuffer[i + 2],\n          this.imgBuffer[i + 3]\n        ),\n        x,\n        y\n      );\n      this.imgBuffer[i] = color.red;\n      this.imgBuffer[i + 1] = color.green;\n      this.imgBuffer[i + 2] = color.blue;\n      this.imgBuffer[i + 3] = color.alpha;\n    }\n    return this;\n  }\n\n  /**\n   * Return pxl color at (i,j)\n   * @param {*} i: integer \\in [0,H-1]\n   * @param {*} j: integer \\in [0,W-1]\n   * @returns color\n   */\n  getPxl(i, j) {\n    const { width, height } = this.canvas;\n    if ((i < 0 || i >= height) && (j < 0 || j >= width))\n      return new CanvasException(\"pxl out of bounds\");\n    const w = width * 4;\n    const index = i * w + 4 * j;\n    return Color.ofRGBA(\n      this.imgBuffer[index],\n      this.imgBuffer[index + 1],\n      this.imgBuffer[index + 2],\n      this.imgBuffer[index + 3]\n    );\n  }\n\n  /**\n   * Set pxl color at (i,j)\n   * @param {*} i: integer \\in [0,H-1]\n   * @param {*} j: integer \\in [0,W-1]\n   * @param {*} color\n   */\n  setPxl(i, j, color) {\n    const { width, height } = this.canvas;\n    if ((i < 0 || i >= height) && (j < 0 || j >= width)) return;\n    const w = width * 4;\n    const index = i * w + 4 * j;\n    this.imgBuffer[index] = color.red;\n    this.imgBuffer[index + 1] = color.green;\n    this.imgBuffer[index + 2] = color.blue;\n    this.imgBuffer[index + 3] = color.alpha;\n    return this;\n  }\n\n  paint() {\n    this.ctx.putImageData(this.image, 0, 0);\n  }\n\n  //========================================================================================\n  /*                                                                                      *\n   *                                   static functions                                   *\n   *                                                                                      */\n  //========================================================================================\n\n  static builder() {\n    return new CanvasBuilder();\n  }\n}\n\nclass CanvasBuilder {\n  _canvas = document.createElement(\"canvas\");\n  _width = 500;\n  _height = 500;\n  constructor() {}\n\n  width(width) {\n    this._width = width;\n    return this;\n  }\n\n  height(height) {\n    this._height = height;\n    return this;\n  }\n\n  build() {\n    this._canvas.setAttribute(\"width\", this._width);\n    this._canvas.setAttribute(\"height\", this._height);\n    return new Canvas(this._canvas);\n  }\n}\n\nexport class CanvasException extends Error {}\n","import ImageIO from \"./ImageIO\";\n/*\n Canvas coordinates\n\n 0                  W-1\n +-------------> y\n |\n |\n |       *\n |\n |\n v x\n\n H-1\n */\n\n/*\n\nThe point xe_1 + ye_2 corresponds to a point in the middle of a pxl.\n\nThe canvas data is an array of length colors(C) * width(W) * height(H). Is a 3D-array.\nThe index is a number in [0, C * W * H - 1].\nHaving (x, y, z) where z is the color axis, the formula to index the array is :\n\nf(x, y, z) = C * W * x + C * y + z.\n\nWhere x in [0, H - 1], y in [0, W - 1] and z in [0, C - 1].\n\nNote that f(H - 1, W - 1, C - 1) = C * W * H - 1.\n*/\n\n// Auxiliary functions\nfunction scale(u, r) {\n  var ans = [];\n  ans[0] = u[0] * r;\n  ans[1] = u[1] * r;\n  return ans;\n}\n\nfunction add(u, v) {\n  var ans = [];\n  ans[0] = u[0] + v[0];\n  ans[1] = u[1] + v[1];\n  return ans;\n}\n\nfunction floor(x) {\n  var ans = [];\n  ans[0] = Math.floor(x[0]);\n  ans[1] = Math.floor(x[1]);\n  return ans;\n}\n\nfunction diff(u, v) {\n  var ans = [];\n  ans[0] = u[0] - v[0];\n  ans[1] = u[1] - v[1];\n  return ans;\n}\n\nfunction dot(u, v) {\n  return u[0] * v[0] + u[1] * v[1];\n}\n\nfunction squareNorm(x) {\n  return dot(x, x);\n}\n\nfunction norm(x) {\n  return Math.sqrt(dot(x, x));\n}\n\nfunction min(u, v) {\n  var ans = [];\n  ans[0] = Math.min(u[0], v[0]);\n  ans[1] = Math.min(u[1], v[1]);\n  return ans;\n}\n\nfunction max(u, v) {\n  var ans = [];\n  ans[0] = Math.max(u[0], v[0]);\n  ans[1] = Math.max(u[1], v[1]);\n  return ans;\n}\n\n/**\n * return solution to : [ u_0 , h] x = z_0\n *\n *                       [ u_1,  0] y = z_1\n */\nfunction solve2by2UpperTriMatrix(u, h, z) {\n  var aux = z[1] / u[1];\n  return [aux, (-u[0] * aux + z[0]) / h];\n}\n/**\n * return solution to : [ u_0 , 0] x = z_0\n *\n *                       [ u_1,  w] y = z_1\n */\nfunction solve2by2LowerTriMatrix(u, w, z) {\n  var aux = z[0] / u[0];\n  return [aux, (-u[1] * aux + z[1]) / w];\n}\n\n// Canvas\nvar Canvas = function (canvas) {\n  this.canvas = canvas;\n  this.ctx = canvas.getContext(\"2d\");\n  this.image = this.ctx.getImageData(0, 0, canvas.width, canvas.height);\n  // width * height * 4 array of integers\n  this.imageData = this.image.data;\n};\n\n/**\n * Returns a two vector with Height as first coordinate and Width as second. [Height, Width].\n */\nCanvas.prototype.getSize = function () {\n  return [this.canvas.height, this.canvas.width];\n};\n\n/**\n *  Draw update image on canvas.\n */\nCanvas.prototype.paintImage = function () {\n  this.ctx.putImageData(this.image, 0, 0);\n};\n\nCanvas.prototype.getCanvas = function () {\n  return this.canvas;\n};\n\n/**\n * Clear Image with @rgba color.\n *\n * @param rgba\n */\nCanvas.prototype.clearImage = function (rgba) {\n  this.useCanvasCtx((canvas) => {\n    var size = canvas.getSize();\n    canvas.ctx.fillStyle =\n      \"rgba(\" + rgba[0] + \",\" + rgba[1] + \",\" + rgba[2] + \",\" + rgba[3] + \")\";\n    canvas.ctx.globalCompositeOperation = \"source-over\";\n    canvas.ctx.fillRect(0, 0, size[1], size[0]);\n  }, true);\n};\n\nCanvas.prototype.useCanvasCtx = function (lambda, isClearImage = false) {\n  if (!isClearImage) {\n    this.ctx.putImageData(this.image, 0, 0);\n  }\n  lambda(this);\n  this.image = this.ctx.getImageData(\n    0,\n    0,\n    this.canvas.width,\n    this.canvas.height\n  );\n  this.imageData = this.image.data;\n};\n\nCanvas.prototype.getImageIndex = function (x) {\n  return 4 * (this.canvas.width * x[0] + x[1]);\n};\n\nCanvas.prototype.getPxl = function (x) {\n  var index = this.getImageIndex(x);\n  return [\n    this.imageData[index],\n    this.imageData[index + 1],\n    this.imageData[index + 2],\n    this.imageData[index + 3],\n  ];\n};\n\nCanvas.prototype.drawPxl = function (x, rgb) {\n  var index = this.getImageIndex(x);\n  this.imageData[index] = rgb[0];\n  this.imageData[index + 1] = rgb[1];\n  this.imageData[index + 2] = rgb[2];\n  this.imageData[index + 3] = rgb[3];\n};\n\n/*\n * x1     :   2-dim array\n * x2     :   2-dim array\n * shader :   is a function that receives a 2-dim array and a line (array with 2 points) and returns a rgba 4-dim array\n */\nCanvas.prototype.drawLine = function (x1, x2, shader) {\n  // add points before clip\n  shader.points = [x1, x2];\n\n  // do clipping\n  var stack = [];\n  stack.push(x1);\n  stack.push(x2);\n  var inStack = [];\n  var outStack = [];\n  for (var i = 0; i < stack.length; i++) {\n    var x = stack[i];\n    if (\n      0 <= x[0] &&\n      x[0] < this.canvas.height &&\n      0 <= x[1] &&\n      x[1] < this.canvas.width\n    ) {\n      inStack.push(x);\n    } else {\n      outStack.push(x);\n    }\n  }\n  // both points are inside canvas\n  if (inStack.length == 2) {\n    this.drawLineInt(inStack[0], inStack[1], shader);\n    return;\n  }\n  //intersecting line with canvas\n  var intersectionSolutions = [];\n  var v = [x2[0] - x1[0], x2[1] - x1[1]];\n  // Let s \\in [0,1]\n  // line intersection with [0, 0]^T + [H - 1, 0]^T s\n  intersectionSolutions.push(\n    solve2by2UpperTriMatrix(v, -(this.canvas.height - 1), [-x1[0], -x1[1]])\n  );\n  // line intersection with [H - 1, 0]^T + [0, W - 1]^T s\n  intersectionSolutions.push(\n    solve2by2LowerTriMatrix(v, -(this.canvas.width - 1), [\n      this.canvas.height - 1 - x1[0],\n      -x1[1],\n    ])\n  );\n  // line intersection with [H - 1, W - 1]^T + [-(H - 1), 0]^T s\n  intersectionSolutions.push(\n    solve2by2UpperTriMatrix(v, this.canvas.height - 1, [\n      this.canvas.height - 1 - x1[0],\n      this.canvas.width - 1 - x1[1],\n    ])\n  );\n  // line intersection with [0, W - 1]^T + [0, -(W - 1)]^T s\n  intersectionSolutions.push(\n    solve2by2LowerTriMatrix(v, this.canvas.width - 1, [\n      -x1[0],\n      this.canvas.width - 1 - x1[1],\n    ])\n  );\n\n  var validIntersection = [];\n  for (var i = 0; i < intersectionSolutions.length; i++) {\n    var x = intersectionSolutions[i];\n    if (0 <= x[0] && x[0] <= 1 && 0 <= x[1] && x[1] <= 1) {\n      validIntersection.push(x);\n    }\n  }\n\n  if (validIntersection.length == 0) return;\n\n  //it can be shown that at this point there is at least one valid intersection.\n  if (inStack.length > 0) {\n    var p = [\n      x1[0] + validIntersection[0][0] * v[0],\n      x1[1] + validIntersection[0][0] * v[1],\n    ];\n    this.drawLineInt(inStack.pop(), p, shader);\n    return;\n  }\n\n  var p0 = [\n    x1[0] + validIntersection[0][0] * v[0],\n    x1[1] + validIntersection[0][0] * v[1],\n  ];\n  for (var i = 1; i < validIntersection.length; i++) {\n    var p = [\n      x1[0] + validIntersection[i][0] * v[0],\n      x1[1] + validIntersection[i][0] * v[1],\n    ];\n    var v = diff(p, p0);\n    if (dot(v, v) > 1e-3) {\n      this.drawLineInt(p0, p, shader);\n      return;\n    }\n  }\n  this.drawLineInt(p0, p0, shader);\n};\n\nCanvas.prototype.drawLineInt = function (x1, x2, shader) {\n  x1 = floor(x1);\n  x2 = floor(x2);\n\n  var index = [-1, 0, 1];\n\n  var n = index.length;\n  var nn = n * n;\n\n  var x = [];\n  x[0] = x1[0];\n  x[1] = x1[1];\n\n  var tangent = diff(x2, x1);\n  var normal = [];\n  normal[0] = -tangent[1];\n  normal[1] = tangent[0];\n\n  shader(x, shader.points, this);\n\n  while (x[0] !== x2[0] || x[1] !== x2[1]) {\n    var fmin = Number.MAX_VALUE;\n    var minDir = [];\n    for (var k = 0; k < nn; k++) {\n      var i = index[k % n];\n      var j = index[Math.floor(k / n)];\n\n      var nextX = add(x, [i, j]);\n\n      var v = diff(nextX, x1);\n      var f = Math.abs(dot(v, normal)) - dot(v, tangent);\n      if (fmin > f) {\n        fmin = f;\n        minDir = [i, j];\n      }\n    }\n\n    x = add(x, minDir);\n    shader(x, shader.points, this);\n  }\n  shader(x, shader.points, this);\n};\n\nCanvas.prototype.drawPolygon = function (\n  array,\n  shader,\n  isInsidePoly = Canvas.isInsidePolygon\n) {\n  let upperBox = [\n    [Number.MAX_VALUE, Number.MAX_VALUE],\n    [Number.MIN_VALUE, Number.MIN_VALUE],\n  ];\n  for (let i = 0; i < array.length; i++) {\n    upperBox[0] = min(array[i], upperBox[0]);\n    upperBox[1] = max(array[i], upperBox[1]);\n  }\n\n  let size = this.getSize();\n  let clampedSize = diff(size, [1, 1]);\n  let zeros = [0, 0];\n  upperBox[0] = floor(min(clampedSize, max(zeros, upperBox[0])));\n  upperBox[1] = floor(min(clampedSize, max(zeros, upperBox[1])));\n\n  for (var i = upperBox[0][0]; i < upperBox[1][0]; i++) {\n    for (var j = upperBox[0][1]; j < upperBox[1][1]; j++) {\n      var x = [i, j];\n      if (isInsidePoly(x, array)) {\n        shader(x, array, this);\n      }\n    }\n  }\n};\n\n/*\n * x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * shader :   is a function that receives a 2-dim array and a triangle (array with 3 points) and returns a rgba 4-dim array\n */\nCanvas.prototype.drawTriangle = function (x1, x2, x3, shader) {\n  var array = [x1, x2, x3];\n  this.drawPolygon(array, shader, Canvas.isInsideConvex);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * x4     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas.prototype.drawQuad = function (x1, x2, x3, x4, shader) {\n  this.drawPolygon([x1, x2, x3, x4], shader);\n};\n\nCanvas.prototype.drawImage = function (img, x) {\n  if (\"isReady\" in img && !img.isReady) return;\n  this.useCanvasCtx((canvas) => canvas.ctx.drawImage(img, x[1], x[0]));\n};\n\nCanvas.prototype.drawCircle = function (x, r, shader) {\n  var corner = scale([1, 1], r);\n  var upperBox = [diff(x, corner), add(x, corner)];\n  var size = this.getSize();\n  upperBox[0] = floor(min(diff(size, [1, 1]), max([0, 0], upperBox[0])));\n  upperBox[1] = floor(min(diff(size, [1, 1]), max([0, 0], upperBox[1])));\n  for (var i = upperBox[0][0]; i <= upperBox[1][0]; i++) {\n    for (var j = upperBox[0][1]; j <= upperBox[1][1]; j++) {\n      var p = [i, j];\n      if (this.isInsideCircle(p, x, r)) {\n        shader(p, [x, r], this);\n      }\n    }\n  }\n};\n\nCanvas.prototype.isInsideCircle = function (p, x, r) {\n  return squareNorm(diff(p, x)) <= r * r;\n};\n\nCanvas.prototype.addEventListener = function (key, lambda, useCapture) {\n  this.canvas.addEventListener(key, lambda, useCapture);\n};\n\nCanvas.prototype.drawString = function (x, string, contextShader) {\n  this.useCanvasCtx((canvas) => {\n    contextShader(canvas.ctx);\n    canvas.ctx.fillText(string, x[1], x[0]);\n  });\n};\n\n// Static functions\n\n// slower than isInsideConvex method\nCanvas.isInsidePolygon = function (x, array) {\n  var v = [];\n  var theta = 0;\n  var n = array.length;\n  for (var i = 0; i < n; i++) {\n    v[0] = diff(array[(i + 1) % n], x);\n    v[1] = diff(array[i], x);\n    theta += Math.acos(dot(v[0], v[1]) / (norm(v[0]) * norm(v[1])));\n  }\n  return Math.abs(theta - 2 * Math.PI) < 1e-3;\n};\n\nCanvas.isInsideConvex = function (x, array) {\n  var m = array.length;\n  var v = [];\n  var vDotN = [];\n  for (var i = 0; i < m; i++) {\n    v[i] = diff(array[(i + 1) % m], array[i]);\n    let n = [-v[i][1], v[i][0]];\n    let r = diff(x, array[i]);\n    vDotN[i] = dot(r, n);\n  }\n  let orientation = v[0][0] * v[1][1] - v[0][1] * v[1][0] > 0 ? 1 : -1;\n  for (var i = 0; i < m; i++) {\n    var myDot = vDotN[i] * orientation;\n    if (myDot < 0) return false;\n  }\n  return true;\n};\n\nCanvas.simpleShader = function (color) {\n  return (x, element, canvas) => canvas.drawPxl(x, color);\n};\n\nCanvas.colorShader = function (colors) {\n  var auxShader = (x, poly, canvas, alpha) => {\n    var interpolateColors = [0, 0, 0, 0];\n    for (var i = 0; i < poly.length; i++) {\n      interpolateColors[0] = interpolateColors[0] + colors[i][0] * alpha[i];\n      interpolateColors[1] = interpolateColors[1] + colors[i][1] * alpha[i];\n      interpolateColors[2] = interpolateColors[2] + colors[i][2] * alpha[i];\n      interpolateColors[3] = interpolateColors[3] + colors[i][3] * alpha[i];\n    }\n    canvas.drawPxl(x, interpolateColors);\n  };\n  return Canvas.interpolateTriangleShader(auxShader);\n};\n\nCanvas.interpolateQuadShader = function (shader) {\n  return function (x, quad, canvas) {\n    var t1 = [quad[0], quad[1], quad[2]];\n    var t2 = [quad[2], quad[3], quad[0]];\n    var alpha = Canvas.triangleBaryCoord(x, t1);\n    if (\n      alpha[0] > 0 &&\n      alpha[1] > 0 &&\n      alpha[2] > 0 &&\n      Math.abs(alpha[0] + alpha[1] + alpha[2] - 1) < 1e-10\n    ) {\n      shader(x, quad, canvas, [alpha[0], alpha[1], alpha[2], 0]);\n    } else {\n      alpha = Canvas.triangleBaryCoord(x, t2);\n      shader(x, quad, canvas, [alpha[2], 0, alpha[0], alpha[1]]);\n    }\n  };\n};\n\nCanvas.interpolateTriangleShader = function (shader) {\n  return (x, triangle, canvas) => {\n    const alpha = Canvas.triangleBaryCoord(x, triangle);\n    shader(x, triangle, canvas, alpha);\n  };\n};\n\nCanvas.interpolateLineShader = function (shader) {\n  return (x, line, canvas) => {\n    var v = diff(line[1], line[0]);\n    var z = diff(x, line[0]);\n    var vnorm = squareNorm(v);\n    var projection = dot(z, v);\n    var t = vnorm == 0.0 ? 0 : projection / vnorm;\n    shader(x, line, canvas, t);\n  };\n};\n\n/**\n * img: html loaded image.\n * quadTexCoord: [0, 1]^{2 * 4}, texture coordinates\n */\nCanvas.quadTextureShader = function (\n  img,\n  quadTexCoord,\n  interpolation = Canvas.bilinearInterpolation\n) {\n  let imageCache = null;\n  const imageShader = (x, quad, canvas, alpha) => {\n    if (!img.isReady || imageCache == null)\n      imageCache = new Canvas(ImageIO.getImageCanvas(img));\n    const imageCanvas = imageCache;\n    const imgSize = imageCanvas.getSize();\n    const interpolateTexCoord = [0, 0];\n    for (let i = 0; i < quadTexCoord.length; i++) {\n      interpolateTexCoord[0] =\n        interpolateTexCoord[0] + quadTexCoord[i][0] * alpha[i];\n      interpolateTexCoord[1] =\n        interpolateTexCoord[1] + quadTexCoord[i][1] * alpha[i];\n    }\n    var i = [\n      (1 - interpolateTexCoord[1]) * (imgSize[1] - 1),\n      (imgSize[0] - 1) * interpolateTexCoord[0],\n    ];\n    // bound coordinates\n    i = max([0, 0], min(diff([imgSize[0], imgSize[1]], [1, 1]), i));\n    // pxl lower corner\n    var j = floor(i);\n    var cornerColors = [\n      imageCanvas.getPxl(j),\n      imageCanvas.getPxl(add(j, [1, 0])),\n      imageCanvas.getPxl(add(j, [1, 1])),\n      imageCanvas.getPxl(add(j, [0, 1])),\n    ];\n    var finalColor = interpolation(cornerColors, diff(i, j));\n    canvas.drawPxl(x, finalColor);\n  };\n  return Canvas.interpolateQuadShader(imageShader);\n};\n\nCanvas.triangleCache = (() => {\n  const hashMap = [];\n  const size = 3;\n  return {\n    constains: (triangleHash) => hashMap[triangleHash % size] != undefined,\n    get: (triangleHash) => hashMap[triangleHash % size],\n    set: (triangleHash, value) => (hashMap[triangleHash % size] = value),\n  };\n})(); //{triangle: null, u: [], v:[], det:null, hash:null}\n\nCanvas.triangleHash = (triangle) => {\n  const array = [\n    triangle[0][0],\n    triangle[1][0],\n    triangle[2][0],\n    triangle[0][1],\n    triangle[1][1],\n    triangle[2][1],\n  ];\n  return array.reduce((h, x) => 31 * h + x, 1);\n};\n\nCanvas.triangleBaryCoord = function (x, triangle) {\n  const hash = Canvas.triangleHash(triangle);\n  const y = [x[0] - triangle[0][0], x[1] - triangle[0][1]];\n  if (!Canvas.triangleCache.constains(hash)) {\n    const u = [\n      triangle[1][0] - triangle[0][0],\n      triangle[1][1] - triangle[0][1],\n    ];\n    const v = [\n      triangle[2][0] - triangle[0][0],\n      triangle[2][1] - triangle[0][1],\n    ];\n    const det = u[0] * v[1] - u[1] * v[0];\n    Canvas.triangleCache.set(hash, {\n      triangle: triangle,\n      u: u.map((x) => x / det),\n      v: v.map((x) => x / det),\n      det: det,\n      hash: hash,\n    });\n  }\n  const cache = Canvas.triangleCache.get(hash);\n  const u = cache.u;\n  const v = cache.v;\n  const det = cache.det;\n  if (det == 0) return [0, 0, 0];\n  var alpha = [v[1] * y[0] - v[0] * y[1], u[0] * y[1] - u[1] * y[0]];\n  return [1 - alpha[0] - alpha[1], alpha[0], alpha[1]];\n};\n\n/**\n * values \\in R^{k * 4}\n * x \\in [0,1]^2\n */\nCanvas.bilinearInterpolation = function (values, x) {\n  var acc = [];\n  for (var k = 0; k < values.length; k++) {\n    var f03 = values[0][k] + (values[3][k] - values[0][k]) * x[1];\n    var f12 = values[1][k] + (values[2][k] - values[1][k]) * x[1];\n    var f = f03 + (f12 - f03) * x[0];\n    acc.push(f);\n  }\n  return acc;\n};\n/**\n * size: is an array with width and height of a HTML5 Canvas.\n * domId: DOM element where the canvas will be added\n *\n * returns Canvas object from the generated html canvas.\n */\nCanvas.createCanvas = function (size, domId) {\n  const canvas = document.createElement(\"canvas\");\n  canvas.setAttribute(\"width\", size[0]);\n  canvas.setAttribute(\"height\", size[1]);\n  document.getElementById(domId).appendChild(canvas);\n  return canvas;\n};\n\nexport default Canvas;\n","import Canvas from \"./Canvas\";\n\n//Note that we can switch from heritage to composition, think about that\n\n// cameraSpace : 2-dim array with two 2-dim arrays that are intervals [a,b] | a < b\nvar Canvas2D = function (canvas, cameraSpace) {\n  Canvas.call(this, canvas);\n  if (\n    cameraSpace.length != 2 ||\n    (cameraSpace[0].length != 2 && cameraSpace[1].length != 2)\n  ) {\n    throw \"camera space must be 2-dim array with 2-dim arrays representing an interval\";\n  }\n  this.cameraSpace = cameraSpace;\n};\n\nCanvas2D.prototype = Object.create(Canvas.prototype);\nCanvas2D.prototype.constructor = Canvas2D;\n\n/* x : 2-dim array in camera space coordinates\n * returns : 2-dim array in integer coordinates\n */\nCanvas2D.prototype.integerTransform = function (x) {\n  var xint =\n    (-(this.canvas.height - 1) /\n      (this.cameraSpace[1][1] - this.cameraSpace[1][0])) *\n    (x[1] - this.cameraSpace[1][1]);\n  var yint =\n    ((this.canvas.width - 1) /\n      (this.cameraSpace[0][1] - this.cameraSpace[0][0])) *\n    (x[0] - this.cameraSpace[0][0]);\n  return [xint, yint];\n};\n\n/* x : 2-dim array in integer coordinates\n * returns : 2-dim array in camera space coordinates\n */\nCanvas2D.prototype.inverseTransform = function (x) {\n  var xt =\n    this.cameraSpace[0][0] +\n    ((this.cameraSpace[0][1] - this.cameraSpace[0][0]) /\n      (this.canvas.width - 1)) *\n      x[1];\n  var yt =\n    this.cameraSpace[1][1] -\n    ((this.cameraSpace[1][1] - this.cameraSpace[1][0]) /\n      (this.canvas.height - 1)) *\n      x[0];\n  return [xt, yt];\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawLine = function (x1, x2, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  Canvas.prototype.drawLine.call(this, y1, y2, shader);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawTriangle = function (x1, x2, x3, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  const y3 = this.integerTransform(x3);\n  Canvas.prototype.drawTriangle.call(this, y1, y2, y3, shader);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * x4     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawQuad = function (x1, x2, x3, x4, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  const y3 = this.integerTransform(x3);\n  const y4 = this.integerTransform(x4);\n  Canvas.prototype.drawQuad.call(this, y1, y2, y3, y4, shader);\n};\n\nCanvas2D.prototype.drawCircle = function (x, r, shader) {\n  // it assumes squared canvas, for now ...\n  const y = this.integerTransform(x);\n  const z = this.integerTransform([r, 0])[1] - this.integerTransform([0, 0])[1];\n  Canvas.prototype.drawCircle.call(this, y, z, shader);\n};\n\nCanvas2D.prototype.drawImage = function (img, x) {\n  Canvas.prototype.drawImage.call(this, img, this.integerTransform(x));\n};\n\nCanvas2D.prototype.drawString = function (x, string, contextShader) {\n  const y = this.integerTransform(x);\n  Canvas.prototype.drawString.call(this, y, string, contextShader);\n};\n\n// camera : 2-dim array with two 2-dim arrays that are intervals [a,b] | a < b\nCanvas2D.prototype.setCamera = function (camera) {\n  if (camera.length != 2 || (camera[0].length != 2 && camera[1].length != 2)) {\n    throw \"camera space must be 2-dim array with 2-dim arrays representing an interval\";\n  }\n  this.cameraSpace = camera;\n};\n\nexport default Canvas2D;\n","const ImageIO = {\n  // empty object\n};\n\n/**\n * img : html image\n */\nImageIO.getImageCanvas = img => {\n  const canvasAux = document.createElement(\"canvas\");\n  canvasAux.width = img.width;\n  canvasAux.height = img.height;\n  const contextAux = canvasAux.getContext(\"2d\");\n  contextAux.fillStyle = \"rgba(0, 0, 0, 0)\";\n  contextAux.globalCompositeOperation = \"source-over\";\n  contextAux.fillRect(0, 0, canvasAux.width, canvasAux.height);\n  contextAux.drawImage(img, 0, 0);\n  return canvasAux;\n};\n\n/**\n * img : html image\n */\nImageIO.getDataFromImage = img => {\n  canvas = ImageIO.getImageCanvas(img);\n  return canvas.getContext(\"2d\").getImageData(0, 0, img.width, img.height);\n};\n\nImageIO.loadImage = src => {\n  const img = new Image();\n  img.src = src;\n  img.isReady = false;\n  img.onload = () => (img.isReady = true);\n  return img;\n};\n\nImageIO.generateImageReadyPredicate = img => () => img.isReady;\n\nexport default ImageIO;\n","export default class Color {\n  /**\n   *\n   * @param {*} rgba: Uint8Array\n   */\n  constructor(rgba) {\n    this.rgba = rgba;\n  }\n\n  getRGBA() {\n    return this.rgba;\n  }\n\n  static ofRGBA(red = 0, green = 0, blue = 0, alpha = 255) {\n    const rgba = new Uint8Array(4);\n    rgba[0] = red;\n    rgba[1] = green;\n    rgba[2] = blue;\n    rgba[3] = alpha;\n    return new Color(rgba);\n  }\n\n  static random() {\n    const r = () => Math.random() * 256;\n    return Color.ofRGBA(r(), r(), r(), r());\n  }\n\n  get red() {\n    return this.rgba[0];\n  }\n\n  get green() {\n    return this.rgba[1];\n  }\n\n  get blue() {\n    return this.rgba[2];\n  }\n\n  get alpha() {\n    return this.rgba[3];\n  }\n}\n","const ArrayUtils = {};\n\nArrayUtils.TYPED_ARRAY = {\n  Uint8Array: (...array) => Uint8ArrayFactory(array),\n};\n\nexport { ArrayUtils };\n\nexport const perf = (lambda) => {\n  const t = performance.now();\n  lambda();\n  return performance.now() - t;\n};\n\nfunction Uint8ArrayFactory(array) {\n  const answer = new Uint8Array(array.length);\n  for (let i = 0; i < answer.length; i++) {\n    answer[i] = array[i];\n  }\n  return answer;\n}\n","import Canvas_old from \"./Canvas_old/main/Canvas\";\nimport Canvas2D_old from \"./Canvas_old/main/Canvas2D\";\nimport ImageIO from \"./Canvas_old/main/ImageIO\";\nimport Canvas from \"./Canvas/main/Canvas\";\nimport Color from \"./Color/main/Color\";\nimport * as Utils from \"./Utils/main/Utils\";\nimport Animator from \"./Animator/main/Animator\";\nexport { Canvas_old, Canvas2D_old, ImageIO, Canvas, Color, Utils, Animator };\n","module.exports = require(\"@babel/runtime/helpers/esm/classCallCheck\");","module.exports = require(\"@babel/runtime/helpers/esm/createClass\");","module.exports = require(\"@babel/runtime/helpers/esm/defineProperty\");","module.exports = require(\"@babel/runtime/helpers/esm/getPrototypeOf\");","module.exports = require(\"@babel/runtime/helpers/esm/inherits\");","module.exports = require(\"@babel/runtime/helpers/esm/possibleConstructorReturn\");","module.exports = require(\"@babel/runtime/helpers/esm/wrapNativeSuper\");"],"sourceRoot":""}