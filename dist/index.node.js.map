{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/Animator/main/Animator.js","webpack:///./src/BBox/main/BBox.js","webpack:///./src/Canvas/main/Canvas.js","webpack:///./src/Canvas_old/main/Canvas.js","webpack:///./src/Canvas_old/main/Canvas2D.js","webpack:///./src/Canvas_old/main/ImageIO.js","webpack:///./src/Color/main/Color.js","webpack:///./src/Matrix/main/Matrix.js","webpack:///./src/Utils/main/Utils.js","webpack:///./src/index.js","webpack:///external \"@babel/runtime/helpers/esm/classCallCheck\"","webpack:///external \"@babel/runtime/helpers/esm/createClass\"","webpack:///external \"@babel/runtime/helpers/esm/defineProperty\"","webpack:///external \"@babel/runtime/helpers/esm/getPrototypeOf\"","webpack:///external \"@babel/runtime/helpers/esm/inherits\"","webpack:///external \"@babel/runtime/helpers/esm/possibleConstructorReturn\"","webpack:///external \"@babel/runtime/helpers/esm/slicedToArray\"","webpack:///external \"@babel/runtime/helpers/esm/toConsumableArray\"","webpack:///external \"@babel/runtime/helpers/esm/wrapNativeSuper\""],"names":["Animator","state","next","doWhile","requestAnimeId","requestAnimationFrame","stop","play","cancelAnimationFrame","AnimatorBuilder","_state","_next","_end","end","someAreEmpty","some","x","undefined","Error","BBox","min","max","add","sub","isEmpty","op","Math","center","scale","diagonal","box","newMin","newMax","newDiag","isAllPositive","data","every","EMPTY","vector","actionByTypes","type","action","Matrix","i","length","equals","point","vec","vec2","Canvas","canvas","getCanvas","ctx","getContext","image","getImageData","width","height","imgBuffer","color","fillStyle","red","green","blue","alpha","fillRect","lambda","n","w","floor","y","Color","ofRGBA","j","CanvasException","index","start","shader","line","_clipLine","p0","p1","v","reduce","e","abs","k","map","putImageData","bbox","ZERO","of","pointStack","inStack","outStack","p","collidesWith","push","inPoint","outPoint","_getLineCanvasIntersection","boundary","intersectionSolutions","forEach","s","d","get","solution","_solveLowTriMatrix","_solveUpTriMatrix","validIntersections","t","a","f","v1","v2","v12","f1","f2","av2","CanvasBuilder","document","createElement","_width","_height","_canvas","setAttribute","u","r","ans","diff","dot","squareNorm","norm","sqrt","solve2by2UpperTriMatrix","h","z","aux","solve2by2LowerTriMatrix","imageData","prototype","getSize","paintImage","clearImage","rgba","useCanvasCtx","size","globalCompositeOperation","isClearImage","getImageIndex","getPxl","drawPxl","rgb","drawLine","x1","x2","points","stack","drawLineInt","validIntersection","pop","nn","tangent","normal","fmin","Number","MAX_VALUE","minDir","nextX","drawPolygon","array","isInsidePoly","isInsidePolygon","upperBox","MIN_VALUE","clampedSize","zeros","drawTriangle","x3","isInsideConvex","drawQuad","x4","drawImage","img","isReady","drawCircle","corner","isInsideCircle","addEventListener","key","useCapture","drawString","string","contextShader","fillText","theta","acos","PI","m","vDotN","orientation","myDot","simpleShader","element","colorShader","colors","auxShader","poly","interpolateColors","interpolateTriangleShader","interpolateQuadShader","quad","t1","t2","triangleBaryCoord","triangle","interpolateLineShader","vnorm","projection","quadTextureShader","quadTexCoord","interpolation","bilinearInterpolation","imageCache","imageShader","ImageIO","getImageCanvas","imageCanvas","imgSize","interpolateTexCoord","cornerColors","finalColor","triangleCache","hashMap","constains","triangleHash","set","value","hash","det","cache","values","acc","f03","f12","createCanvas","domId","getElementById","appendChild","Canvas2D","cameraSpace","call","Object","create","constructor","integerTransform","xint","yint","inverseTransform","xt","yt","y1","y2","y3","y4","setCamera","camera","canvasAux","contextAux","getDataFromImage","loadImage","src","Image","onload","generateImageReadyPredicate","Uint8Array","random","getIndexFromCoord","_","getCoordFromIndex","index2Key","key2Index","split","MatrixBuilder","_size","MatrixError","Float64Array","indexer","keys","RowBuilder","rows","dim","cols","indexF","ColBuilder","shape","matrix","l","prod","getCoord","identity","binaryLambda","mRows","mCols","b","real","precision","error","builder","build","addCol","addRow","en","matrixBuilder","colBuilder","e0","e1","e2","perf","performance","now","test","title","canvasFactory","timeInMillis","domTest","testTitle","innerText","getDom","timeDom","body"],"mappings":"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","file":"index.node.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default class Animator {\n  constructor(state, next, doWhile) {\n    this.state = state;\n    this.next = next;\n    this.while = doWhile;\n    this.requestAnimeId = null;\n  }\n\n  play() {\n    this.requestAnimeId = requestAnimationFrame(() => {\n      if (!this.while(this.state)) return this.stop();\n      this.state = this.next(this.state);\n      this.play();\n    });\n    return this;\n  }\n\n  stop() {\n    cancelAnimationFrame(this.requestAnimeId);\n    return this;\n  }\n\n  static builder() {\n    return new AnimatorBuilder();\n  }\n}\n\nclass AnimatorBuilder {\n  constructor() {\n    this._state = null;\n    this._next = null;\n    this._end = null;\n  }\n\n  initialState(state) {\n    this._state = state;\n    return this;\n  }\n\n  nextState(next) {\n    this._next = next;\n    return this;\n  }\n\n  while(end) {\n    this._end = end;\n    return this;\n  }\n\n  build() {\n    const someAreEmpty = [this._state, this._next, this._end].some(\n      (x) => x === null || x === undefined\n    );\n    if (someAreEmpty) throw new Error(\"Animator properties are missing\");\n    return new Animator(this._state, this._next, this._end);\n  }\n}\n","import Matrix from \"../../Matrix/main/Matrix\";\n\nexport default class BBox {\n  constructor(min, max) {\n    this.isEmpty = min === undefined || max === undefined;\n    if (this.isEmpty) return this;\n    this.min = min.op(max, Math.min);\n    this.max = max.op(min, Math.max);\n    this.center = min.add(max).scale(1 / 2);\n    this.diagonal = max.sub(min);\n  }\n  /**\n   * Union of boxes\n   * @param {*} box\n   */\n  add(box) {\n    const { min, max } = this;\n    return new BBox(min.op(box.min, Math.min), max.op(box.max, Math.max));\n  }\n\n  union = this.add;\n\n  /**\n   * Intersection of boxes\n   * @param {*} box\n   */\n  sub(box) {\n    const { min, max } = this;\n    const newMin = min.op(box.min, Math.max);\n    const newMax = max.op(box.max, Math.min);\n    const newDiag = newMax.sub(newMin);\n    const isAllPositive = newDiag.data.every((x) => x >= 0);\n    return !isAllPositive ? BBox.EMPTY : new BBox(newMin, newMax);\n  }\n\n  inter = this.sub;\n\n  move(vector) {\n    return new BBox(this.min.add(vector), this.max.add(vector));\n  }\n\n  collidesWith(box) {\n    const actionByTypes = [\n      { type: BBox, action: () => !this.sub(box).isEmpty },\n      { type: Matrix, action: () => !this.sub(new BBox(box, box)).isEmpty },\n    ];\n    for (let i = 0; i < actionByTypes.length; i++) {\n      if (box instanceof actionByTypes[i].type) {\n        return actionByTypes[i].action();\n      }\n    }\n  }\n\n  equals(box) {\n    if (!(box instanceof BBox)) return false;\n    if (this == BBox.EMPTY) return true;\n    return this.min.equals(box.min) && this.max.equals(box.max);\n  }\n\n  static ofPoint(...array) {\n    const point = Matrix.vec(...array);\n    return new BBox(point, point);\n  }\n  static EMPTY = new BBox();\n}\n","import Color from \"../../Color/main/Color\";\nimport Matrix from \"../../Matrix/main/Matrix\";\nimport BBox from \"../../BBox/main/BBox\";\nconst { vec2 } = Matrix;\n/*\n Canvas coordinates\n\n 0                  W-1\n +-------------> y\n |\n |\n |       *\n |\n |\n v x\n\n H-1\n */\n\n/*\n\nThe point xe_1 + ye_2 corresponds to a point in the middle of a pxl.\n\nThe canvas data is an array of length colors(C) * width(W) * height(H). Is a 3D-array.\nThe index is a number in [0, C * W * H - 1].\nHaving (x, y, z) where z is the color axis, the formula to index the array is :\n\nf(x, y, z) = C * W * x + C * y + z.\n\nWhere x in [0, H - 1], y in [0, W - 1] and z in [0, C - 1].\n\nNote that f(H - 1, W - 1, C - 1) = C * W * H - 1.\n*/\n\nexport default class Canvas {\n  /**\n   *\n   * @param {*} canvas: DOM element of type canvas\n   */\n  constructor(canvas) {\n    this.canvas = canvas;\n    this.ctx = canvas.getContext(\"2d\");\n    this.image = this.ctx.getImageData(0, 0, canvas.width, canvas.height);\n    // width * height * 4 array of integers\n    this.imgBuffer = this.image.data;\n  }\n\n  getCanvas() {\n    return this.canvas;\n  }\n\n  getDom = this.getCanvas;\n\n  //========================================================================================\n  /*                                                                                      *\n   *                                 side effects function                                *\n   *                                                                                      */\n  //========================================================================================\n\n  /**\n   * Update color of canvas\n   * @param {*} color: Color\n   */\n  fill(color) {\n    this.ctx.fillStyle = `rgba(${color.red}, ${color.green}, ${color.blue}, ${\n      color.alpha / 255.0\n    })`;\n    this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    this.image = this.ctx.getImageData(\n      0,\n      0,\n      this.canvas.width,\n      this.canvas.height\n    );\n    this.imgBuffer = this.image.data;\n    return this;\n  }\n\n  /**\n   *\n   * @param {*} lambda: (Color,x:number,y:number) => Color\n   */\n  map(lambda = () => {}) {\n    const n = this.imgBuffer.length;\n    const { width: w } = this.canvas;\n    for (let i = 0; i < n; i += 4) {\n      const x = Math.floor(i / (4 * w));\n      const y = Math.floor(i / 4) % w;\n      const color = lambda(\n        Color.ofRGBA(\n          this.imgBuffer[i],\n          this.imgBuffer[i + 1],\n          this.imgBuffer[i + 2],\n          this.imgBuffer[i + 3]\n        ),\n        x,\n        y\n      );\n      this.imgBuffer[i] = color.red;\n      this.imgBuffer[i + 1] = color.green;\n      this.imgBuffer[i + 2] = color.blue;\n      this.imgBuffer[i + 3] = color.alpha;\n    }\n    return this;\n  }\n\n  /**\n   * Return pxl color at (i,j)\n   * @param {*} i: integer \\in [0,H-1]\n   * @param {*} j: integer \\in [0,W-1]\n   * @returns color\n   */\n  getPxl(i, j) {\n    const { width, height } = this.canvas;\n    if ((i < 0 || i >= height) && (j < 0 || j >= width))\n      return new CanvasException(\"pxl out of bounds\");\n    const index = 4 * (i * width + j);\n    return Color.ofRGBA(\n      this.imgBuffer[index],\n      this.imgBuffer[index + 1],\n      this.imgBuffer[index + 2],\n      this.imgBuffer[index + 3]\n    );\n  }\n\n  /**\n   * Set pxl color at (i,j)\n   * @param {*} i: integer \\in [0,H-1]\n   * @param {*} j: integer \\in [0,W-1]\n   * @param {*} color\n   */\n  setPxl(i, j, color) {\n    const { width, height } = this.canvas;\n    if ((i < 0 || i >= height) && (j < 0 || j >= width)) return this;\n    const index = 4 * (i * width + j);\n    this.imgBuffer[index] = color.red;\n    this.imgBuffer[index + 1] = color.green;\n    this.imgBuffer[index + 2] = color.blue;\n    this.imgBuffer[index + 3] = color.alpha;\n    return this;\n  }\n\n  /**\n   *\n   * @param {*} start: 2-Array\n   * @param {*} end: 2-Array\n   * @param {}\n   */\n  drawLine(start, end, shader = (x, y) => Color.ofRGBA(0, 0, 0)) {\n    const { width, height } = this.canvas;\n    const line = this._clipLine(start, end);\n    const [p0, p1] = line;\n    const v = p1.sub(p0);\n    const n = v.reduce((e, x) => e + Math.abs(x));\n    for (let k = 0; k < n; k++) {\n      const x = p0.add(v.scale(k / n)).map(Math.floor);\n      const [i, j] = x.data;\n      const index = 4 * (i * width + j);\n      const color = shader(i, j);\n      this.imgBuffer[index] = color.red;\n      this.imgBuffer[index + 1] = color.green;\n      this.imgBuffer[index + 2] = color.blue;\n      this.imgBuffer[index + 3] = color.alpha;\n    }\n    return this;\n  }\n\n  paint() {\n    this.ctx.putImageData(this.image, 0, 0);\n  }\n\n  //========================================================================================\n  /*                                                                                      *\n   *                                  Auxiliary functions                                  *\n   *                                                                                      */\n  //========================================================================================\n\n  /**\n   *\n   * @param {*} start: 2-Array<Number>\n   * @param {*} end: 2-Array<Number>\n   * @returns 2-Array<vec2>\n   */\n  _clipLine(start, end) {\n    const { width, height } = this.canvas;\n    const bbox = new BBox(vec2.ZERO, vec2.of(height, width));\n    const pointStack = [start, end].map((x) => vec2.of(...x));\n    const inStack = [];\n    const outStack = [];\n    for (let i = 0; i < pointStack.length; i++) {\n      const p = pointStack[i];\n      if (bbox.collidesWith(p)) {\n        inStack.push(p);\n      } else {\n        outStack.push(p);\n      }\n    }\n    // both points are inside\n    if (inStack.length >= 2) {\n      return inStack;\n    }\n    // one of them is inside\n    if (inStack.length === 1) {\n      const [inPoint] = inStack;\n      const [outPoint] = outStack;\n      return this._getLineCanvasIntersection(inPoint, outPoint);\n    }\n    // both points are outside,need to intersect the boundary\n    return this._getLineCanvasIntersection(...outStack);\n  }\n\n  /**\n   *\n   * @param {*} start: vec2(matrix)\n   * @param {*} end: vec2(matrix)\n   */\n  _getLineCanvasIntersection(start, end) {\n    const { width, height } = this.canvas;\n    const v = end.sub(start);\n    // point and direction of boundary\n    const boundary = [\n      [vec2.ZERO, vec2.of(height, 0)],\n      [vec2.of(height, 0), vec2.of(0, width)],\n      [vec2.of(height, 0).add(vec2.of(0, width)), vec2.of(-height, 0)],\n      [vec2.of(0, width), vec2.of(0, -width)],\n    ];\n    const intersectionSolutions = [];\n    boundary.forEach(([s, d]) => {\n      if (d.get(0) === 0) {\n        const solution = this._solveLowTriMatrix(v, d.get(1), s.sub(start));\n        solution !== undefined && intersectionSolutions.push(solution);\n      } else {\n        const solution = this._solveUpTriMatrix(v, d.get(0), s.sub(start));\n        solution !== undefined && intersectionSolutions.push(solution);\n      }\n    });\n    const validIntersections = [];\n    intersectionSolutions.forEach((solution) => {\n      const [x, y] = [solution.get(0), solution.get(1)];\n      if (0 <= x && x <= 1 && 0 <= y && y <= 1) {\n        validIntersections.push(solution);\n      }\n    });\n    if (validIntersections.length === 0) return [];\n    return validIntersections.map((solution) => {\n      const t = solution.get(0);\n      return start.add(v.scale(t));\n    });\n  }\n\n  /**\n   *\n   * @param {*} v: vec2\n   * @param {*} a: number\n   * @param {*} f: vec2\n   * @returns vec2\n   */\n  _solveLowTriMatrix(v, a, f) {\n    const v1 = v.get(0);\n    const v2 = v.get(1);\n    const v12 = v1 * v2;\n    if (v12 === 0 || v1 === 0) return undefined;\n    const f1 = f.get(0);\n    const f2 = f.get(1);\n    return vec2.of(f1 / v1, (f2 * v1 - a * f1) / v12);\n  }\n\n  /**\n   *\n   * @param {*} v: vec2\n   * @param {*} a: number\n   * @param {*} f: vec2\n   * @returns vec2\n   */\n  _solveUpTriMatrix(v, a, f) {\n    const v1 = v.get(0);\n    const v2 = v.get(1);\n    const av2 = a * v2;\n    if (av2 === 0 || v2 === 0) return undefined;\n    const f1 = f.get(0);\n    const f2 = f.get(1);\n    return vec2.of(f2 / v2, (f1 * v2 - v1 * f2) / av2);\n  }\n\n  //========================================================================================\n  /*                                                                                      *\n   *                                   Static functions                                   *\n   *                                                                                      */\n  //========================================================================================\n\n  static builder() {\n    return new CanvasBuilder();\n  }\n}\n\nclass CanvasBuilder {\n  _canvas = document.createElement(\"canvas\");\n  _width = 500;\n  _height = 500;\n  constructor() {}\n\n  width(width) {\n    this._width = width;\n    return this;\n  }\n\n  height(height) {\n    this._height = height;\n    return this;\n  }\n\n  build() {\n    this._canvas.setAttribute(\"width\", this._width);\n    this._canvas.setAttribute(\"height\", this._height);\n    return new Canvas(this._canvas);\n  }\n}\n\nexport class CanvasException extends Error {}\n","import ImageIO from \"./ImageIO\";\n/*\n Canvas coordinates\n\n 0                  W-1\n +-------------> y\n |\n |\n |       *\n |\n |\n v x\n\n H-1\n */\n\n/*\n\nThe point xe_1 + ye_2 corresponds to a point in the middle of a pxl.\n\nThe canvas data is an array of length colors(C) * width(W) * height(H). Is a 3D-array.\nThe index is a number in [0, C * W * H - 1].\nHaving (x, y, z) where z is the color axis, the formula to index the array is :\n\nf(x, y, z) = C * W * x + C * y + z.\n\nWhere x in [0, H - 1], y in [0, W - 1] and z in [0, C - 1].\n\nNote that f(H - 1, W - 1, C - 1) = C * W * H - 1.\n*/\n\n// Auxiliary functions\nfunction scale(u, r) {\n  var ans = [];\n  ans[0] = u[0] * r;\n  ans[1] = u[1] * r;\n  return ans;\n}\n\nfunction add(u, v) {\n  var ans = [];\n  ans[0] = u[0] + v[0];\n  ans[1] = u[1] + v[1];\n  return ans;\n}\n\nfunction floor(x) {\n  var ans = [];\n  ans[0] = Math.floor(x[0]);\n  ans[1] = Math.floor(x[1]);\n  return ans;\n}\n\nfunction diff(u, v) {\n  var ans = [];\n  ans[0] = u[0] - v[0];\n  ans[1] = u[1] - v[1];\n  return ans;\n}\n\nfunction dot(u, v) {\n  return u[0] * v[0] + u[1] * v[1];\n}\n\nfunction squareNorm(x) {\n  return dot(x, x);\n}\n\nfunction norm(x) {\n  return Math.sqrt(dot(x, x));\n}\n\nfunction min(u, v) {\n  var ans = [];\n  ans[0] = Math.min(u[0], v[0]);\n  ans[1] = Math.min(u[1], v[1]);\n  return ans;\n}\n\nfunction max(u, v) {\n  var ans = [];\n  ans[0] = Math.max(u[0], v[0]);\n  ans[1] = Math.max(u[1], v[1]);\n  return ans;\n}\n\n/**\n * return solution to : [ u_0 , h] x = z_0\n *\n *                       [ u_1,  0] y = z_1\n */\nfunction solve2by2UpperTriMatrix(u, h, z) {\n  var aux = z[1] / u[1];\n  return [aux, (-u[0] * aux + z[0]) / h];\n}\n/**\n * return solution to : [ u_0 , 0] x = z_0\n *\n *                       [ u_1,  w] y = z_1\n */\nfunction solve2by2LowerTriMatrix(u, w, z) {\n  var aux = z[0] / u[0];\n  return [aux, (-u[1] * aux + z[1]) / w];\n}\n\n// Canvas\nvar Canvas = function (canvas) {\n  this.canvas = canvas;\n  this.ctx = canvas.getContext(\"2d\");\n  this.image = this.ctx.getImageData(0, 0, canvas.width, canvas.height);\n  // width * height * 4 array of integers\n  this.imageData = this.image.data;\n};\n\n/**\n * Returns a two vector with Height as first coordinate and Width as second. [Height, Width].\n */\nCanvas.prototype.getSize = function () {\n  return [this.canvas.height, this.canvas.width];\n};\n\n/**\n *  Draw update image on canvas.\n */\nCanvas.prototype.paintImage = function () {\n  this.ctx.putImageData(this.image, 0, 0);\n};\n\nCanvas.prototype.getCanvas = function () {\n  return this.canvas;\n};\n\n/**\n * Clear Image with @rgba color.\n *\n * @param rgba\n */\nCanvas.prototype.clearImage = function (rgba) {\n  this.useCanvasCtx((canvas) => {\n    var size = canvas.getSize();\n    canvas.ctx.fillStyle =\n      \"rgba(\" + rgba[0] + \",\" + rgba[1] + \",\" + rgba[2] + \",\" + rgba[3] + \")\";\n    canvas.ctx.globalCompositeOperation = \"source-over\";\n    canvas.ctx.fillRect(0, 0, size[1], size[0]);\n  }, true);\n};\n\nCanvas.prototype.useCanvasCtx = function (lambda, isClearImage = false) {\n  if (!isClearImage) {\n    this.ctx.putImageData(this.image, 0, 0);\n  }\n  lambda(this);\n  this.image = this.ctx.getImageData(\n    0,\n    0,\n    this.canvas.width,\n    this.canvas.height\n  );\n  this.imageData = this.image.data;\n};\n\nCanvas.prototype.getImageIndex = function (x) {\n  return 4 * (this.canvas.width * x[0] + x[1]);\n};\n\nCanvas.prototype.getPxl = function (x) {\n  var index = this.getImageIndex(x);\n  return [\n    this.imageData[index],\n    this.imageData[index + 1],\n    this.imageData[index + 2],\n    this.imageData[index + 3],\n  ];\n};\n\nCanvas.prototype.drawPxl = function (x, rgb) {\n  var index = this.getImageIndex(x);\n  this.imageData[index] = rgb[0];\n  this.imageData[index + 1] = rgb[1];\n  this.imageData[index + 2] = rgb[2];\n  this.imageData[index + 3] = rgb[3];\n};\n\n/*\n * x1     :   2-dim array\n * x2     :   2-dim array\n * shader :   is a function that receives a 2-dim array and a line (array with 2 points) and returns a rgba 4-dim array\n */\nCanvas.prototype.drawLine = function (x1, x2, shader) {\n  // add points before clip\n  shader.points = [x1, x2];\n\n  // do clipping\n  var stack = [];\n  stack.push(x1);\n  stack.push(x2);\n  var inStack = [];\n  var outStack = [];\n  for (var i = 0; i < stack.length; i++) {\n    var x = stack[i];\n    if (\n      0 <= x[0] &&\n      x[0] < this.canvas.height &&\n      0 <= x[1] &&\n      x[1] < this.canvas.width\n    ) {\n      inStack.push(x);\n    } else {\n      outStack.push(x);\n    }\n  }\n  // both points are inside canvas\n  if (inStack.length == 2) {\n    this.drawLineInt(inStack[0], inStack[1], shader);\n    return;\n  }\n  //intersecting line with canvas\n  var intersectionSolutions = [];\n  var v = [x2[0] - x1[0], x2[1] - x1[1]];\n  // Let s \\in [0,1]\n  // line intersection with [0, 0]^T + [H - 1, 0]^T s\n  intersectionSolutions.push(\n    solve2by2UpperTriMatrix(v, -(this.canvas.height - 1), [-x1[0], -x1[1]])\n  );\n  // line intersection with [H - 1, 0]^T + [0, W - 1]^T s\n  intersectionSolutions.push(\n    solve2by2LowerTriMatrix(v, -(this.canvas.width - 1), [\n      this.canvas.height - 1 - x1[0],\n      -x1[1],\n    ])\n  );\n  // line intersection with [H - 1, W - 1]^T + [-(H - 1), 0]^T s\n  intersectionSolutions.push(\n    solve2by2UpperTriMatrix(v, this.canvas.height - 1, [\n      this.canvas.height - 1 - x1[0],\n      this.canvas.width - 1 - x1[1],\n    ])\n  );\n  // line intersection with [0, W - 1]^T + [0, -(W - 1)]^T s\n  intersectionSolutions.push(\n    solve2by2LowerTriMatrix(v, this.canvas.width - 1, [\n      -x1[0],\n      this.canvas.width - 1 - x1[1],\n    ])\n  );\n\n  var validIntersection = [];\n  for (var i = 0; i < intersectionSolutions.length; i++) {\n    var x = intersectionSolutions[i];\n    if (0 <= x[0] && x[0] <= 1 && 0 <= x[1] && x[1] <= 1) {\n      validIntersection.push(x);\n    }\n  }\n\n  if (validIntersection.length == 0) return;\n\n  //it can be shown that at this point there is at least one valid intersection.\n  if (inStack.length > 0) {\n    var p = [\n      x1[0] + validIntersection[0][0] * v[0],\n      x1[1] + validIntersection[0][0] * v[1],\n    ];\n    this.drawLineInt(inStack.pop(), p, shader);\n    return;\n  }\n\n  var p0 = [\n    x1[0] + validIntersection[0][0] * v[0],\n    x1[1] + validIntersection[0][0] * v[1],\n  ];\n  for (var i = 1; i < validIntersection.length; i++) {\n    var p = [\n      x1[0] + validIntersection[i][0] * v[0],\n      x1[1] + validIntersection[i][0] * v[1],\n    ];\n    var v = diff(p, p0);\n    if (dot(v, v) > 1e-3) {\n      this.drawLineInt(p0, p, shader);\n      return;\n    }\n  }\n  this.drawLineInt(p0, p0, shader);\n};\n\nCanvas.prototype.drawLineInt = function (x1, x2, shader) {\n  x1 = floor(x1);\n  x2 = floor(x2);\n\n  var index = [-1, 0, 1];\n\n  var n = index.length;\n  var nn = n * n;\n\n  var x = [];\n  x[0] = x1[0];\n  x[1] = x1[1];\n\n  var tangent = diff(x2, x1);\n  var normal = [];\n  normal[0] = -tangent[1];\n  normal[1] = tangent[0];\n\n  shader(x, shader.points, this);\n\n  while (x[0] !== x2[0] || x[1] !== x2[1]) {\n    var fmin = Number.MAX_VALUE;\n    var minDir = [];\n    for (var k = 0; k < nn; k++) {\n      var i = index[k % n];\n      var j = index[Math.floor(k / n)];\n\n      var nextX = add(x, [i, j]);\n\n      var v = diff(nextX, x1);\n      var f = Math.abs(dot(v, normal)) - dot(v, tangent);\n      if (fmin > f) {\n        fmin = f;\n        minDir = [i, j];\n      }\n    }\n\n    x = add(x, minDir);\n    shader(x, shader.points, this);\n  }\n  shader(x, shader.points, this);\n};\n\nCanvas.prototype.drawPolygon = function (\n  array,\n  shader,\n  isInsidePoly = Canvas.isInsidePolygon\n) {\n  let upperBox = [\n    [Number.MAX_VALUE, Number.MAX_VALUE],\n    [Number.MIN_VALUE, Number.MIN_VALUE],\n  ];\n  for (let i = 0; i < array.length; i++) {\n    upperBox[0] = min(array[i], upperBox[0]);\n    upperBox[1] = max(array[i], upperBox[1]);\n  }\n\n  let size = this.getSize();\n  let clampedSize = diff(size, [1, 1]);\n  let zeros = [0, 0];\n  upperBox[0] = floor(min(clampedSize, max(zeros, upperBox[0])));\n  upperBox[1] = floor(min(clampedSize, max(zeros, upperBox[1])));\n\n  for (var i = upperBox[0][0]; i < upperBox[1][0]; i++) {\n    for (var j = upperBox[0][1]; j < upperBox[1][1]; j++) {\n      var x = [i, j];\n      if (isInsidePoly(x, array)) {\n        shader(x, array, this);\n      }\n    }\n  }\n};\n\n/*\n * x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * shader :   is a function that receives a 2-dim array and a triangle (array with 3 points) and returns a rgba 4-dim array\n */\nCanvas.prototype.drawTriangle = function (x1, x2, x3, shader) {\n  var array = [x1, x2, x3];\n  this.drawPolygon(array, shader, Canvas.isInsideConvex);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * x4     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas.prototype.drawQuad = function (x1, x2, x3, x4, shader) {\n  this.drawPolygon([x1, x2, x3, x4], shader);\n};\n\nCanvas.prototype.drawImage = function (img, x) {\n  if (\"isReady\" in img && !img.isReady) return;\n  this.useCanvasCtx((canvas) => canvas.ctx.drawImage(img, x[1], x[0]));\n};\n\nCanvas.prototype.drawCircle = function (x, r, shader) {\n  var corner = scale([1, 1], r);\n  var upperBox = [diff(x, corner), add(x, corner)];\n  var size = this.getSize();\n  upperBox[0] = floor(min(diff(size, [1, 1]), max([0, 0], upperBox[0])));\n  upperBox[1] = floor(min(diff(size, [1, 1]), max([0, 0], upperBox[1])));\n  for (var i = upperBox[0][0]; i <= upperBox[1][0]; i++) {\n    for (var j = upperBox[0][1]; j <= upperBox[1][1]; j++) {\n      var p = [i, j];\n      if (this.isInsideCircle(p, x, r)) {\n        shader(p, [x, r], this);\n      }\n    }\n  }\n};\n\nCanvas.prototype.isInsideCircle = function (p, x, r) {\n  return squareNorm(diff(p, x)) <= r * r;\n};\n\nCanvas.prototype.addEventListener = function (key, lambda, useCapture) {\n  this.canvas.addEventListener(key, lambda, useCapture);\n};\n\nCanvas.prototype.drawString = function (x, string, contextShader) {\n  this.useCanvasCtx((canvas) => {\n    contextShader(canvas.ctx);\n    canvas.ctx.fillText(string, x[1], x[0]);\n  });\n};\n\n// Static functions\n\n// slower than isInsideConvex method\nCanvas.isInsidePolygon = function (x, array) {\n  var v = [];\n  var theta = 0;\n  var n = array.length;\n  for (var i = 0; i < n; i++) {\n    v[0] = diff(array[(i + 1) % n], x);\n    v[1] = diff(array[i], x);\n    theta += Math.acos(dot(v[0], v[1]) / (norm(v[0]) * norm(v[1])));\n  }\n  return Math.abs(theta - 2 * Math.PI) < 1e-3;\n};\n\nCanvas.isInsideConvex = function (x, array) {\n  var m = array.length;\n  var v = [];\n  var vDotN = [];\n  for (var i = 0; i < m; i++) {\n    v[i] = diff(array[(i + 1) % m], array[i]);\n    let n = [-v[i][1], v[i][0]];\n    let r = diff(x, array[i]);\n    vDotN[i] = dot(r, n);\n  }\n  let orientation = v[0][0] * v[1][1] - v[0][1] * v[1][0] > 0 ? 1 : -1;\n  for (var i = 0; i < m; i++) {\n    var myDot = vDotN[i] * orientation;\n    if (myDot < 0) return false;\n  }\n  return true;\n};\n\nCanvas.simpleShader = function (color) {\n  return (x, element, canvas) => canvas.drawPxl(x, color);\n};\n\nCanvas.colorShader = function (colors) {\n  var auxShader = (x, poly, canvas, alpha) => {\n    var interpolateColors = [0, 0, 0, 0];\n    for (var i = 0; i < poly.length; i++) {\n      interpolateColors[0] = interpolateColors[0] + colors[i][0] * alpha[i];\n      interpolateColors[1] = interpolateColors[1] + colors[i][1] * alpha[i];\n      interpolateColors[2] = interpolateColors[2] + colors[i][2] * alpha[i];\n      interpolateColors[3] = interpolateColors[3] + colors[i][3] * alpha[i];\n    }\n    canvas.drawPxl(x, interpolateColors);\n  };\n  return Canvas.interpolateTriangleShader(auxShader);\n};\n\nCanvas.interpolateQuadShader = function (shader) {\n  return function (x, quad, canvas) {\n    var t1 = [quad[0], quad[1], quad[2]];\n    var t2 = [quad[2], quad[3], quad[0]];\n    var alpha = Canvas.triangleBaryCoord(x, t1);\n    if (\n      alpha[0] > 0 &&\n      alpha[1] > 0 &&\n      alpha[2] > 0 &&\n      Math.abs(alpha[0] + alpha[1] + alpha[2] - 1) < 1e-10\n    ) {\n      shader(x, quad, canvas, [alpha[0], alpha[1], alpha[2], 0]);\n    } else {\n      alpha = Canvas.triangleBaryCoord(x, t2);\n      shader(x, quad, canvas, [alpha[2], 0, alpha[0], alpha[1]]);\n    }\n  };\n};\n\nCanvas.interpolateTriangleShader = function (shader) {\n  return (x, triangle, canvas) => {\n    const alpha = Canvas.triangleBaryCoord(x, triangle);\n    shader(x, triangle, canvas, alpha);\n  };\n};\n\nCanvas.interpolateLineShader = function (shader) {\n  return (x, line, canvas) => {\n    var v = diff(line[1], line[0]);\n    var z = diff(x, line[0]);\n    var vnorm = squareNorm(v);\n    var projection = dot(z, v);\n    var t = vnorm == 0.0 ? 0 : projection / vnorm;\n    shader(x, line, canvas, t);\n  };\n};\n\n/**\n * img: html loaded image.\n * quadTexCoord: [0, 1]^{2 * 4}, texture coordinates\n */\nCanvas.quadTextureShader = function (\n  img,\n  quadTexCoord,\n  interpolation = Canvas.bilinearInterpolation\n) {\n  let imageCache = null;\n  const imageShader = (x, quad, canvas, alpha) => {\n    if (!img.isReady || imageCache == null)\n      imageCache = new Canvas(ImageIO.getImageCanvas(img));\n    const imageCanvas = imageCache;\n    const imgSize = imageCanvas.getSize();\n    const interpolateTexCoord = [0, 0];\n    for (let i = 0; i < quadTexCoord.length; i++) {\n      interpolateTexCoord[0] =\n        interpolateTexCoord[0] + quadTexCoord[i][0] * alpha[i];\n      interpolateTexCoord[1] =\n        interpolateTexCoord[1] + quadTexCoord[i][1] * alpha[i];\n    }\n    var i = [\n      (1 - interpolateTexCoord[1]) * (imgSize[1] - 1),\n      (imgSize[0] - 1) * interpolateTexCoord[0],\n    ];\n    // bound coordinates\n    i = max([0, 0], min(diff([imgSize[0], imgSize[1]], [1, 1]), i));\n    // pxl lower corner\n    var j = floor(i);\n    var cornerColors = [\n      imageCanvas.getPxl(j),\n      imageCanvas.getPxl(add(j, [1, 0])),\n      imageCanvas.getPxl(add(j, [1, 1])),\n      imageCanvas.getPxl(add(j, [0, 1])),\n    ];\n    var finalColor = interpolation(cornerColors, diff(i, j));\n    canvas.drawPxl(x, finalColor);\n  };\n  return Canvas.interpolateQuadShader(imageShader);\n};\n\nCanvas.triangleCache = (() => {\n  const hashMap = [];\n  const size = 3;\n  return {\n    constains: (triangleHash) => hashMap[triangleHash % size] != undefined,\n    get: (triangleHash) => hashMap[triangleHash % size],\n    set: (triangleHash, value) => (hashMap[triangleHash % size] = value),\n  };\n})(); //{triangle: null, u: [], v:[], det:null, hash:null}\n\nCanvas.triangleHash = (triangle) => {\n  const array = [\n    triangle[0][0],\n    triangle[1][0],\n    triangle[2][0],\n    triangle[0][1],\n    triangle[1][1],\n    triangle[2][1],\n  ];\n  return array.reduce((h, x) => 31 * h + x, 1);\n};\n\nCanvas.triangleBaryCoord = function (x, triangle) {\n  const hash = Canvas.triangleHash(triangle);\n  const y = [x[0] - triangle[0][0], x[1] - triangle[0][1]];\n  if (!Canvas.triangleCache.constains(hash)) {\n    const u = [\n      triangle[1][0] - triangle[0][0],\n      triangle[1][1] - triangle[0][1],\n    ];\n    const v = [\n      triangle[2][0] - triangle[0][0],\n      triangle[2][1] - triangle[0][1],\n    ];\n    const det = u[0] * v[1] - u[1] * v[0];\n    Canvas.triangleCache.set(hash, {\n      triangle: triangle,\n      u: u.map((x) => x / det),\n      v: v.map((x) => x / det),\n      det: det,\n      hash: hash,\n    });\n  }\n  const cache = Canvas.triangleCache.get(hash);\n  const u = cache.u;\n  const v = cache.v;\n  const det = cache.det;\n  if (det == 0) return [0, 0, 0];\n  var alpha = [v[1] * y[0] - v[0] * y[1], u[0] * y[1] - u[1] * y[0]];\n  return [1 - alpha[0] - alpha[1], alpha[0], alpha[1]];\n};\n\n/**\n * values \\in R^{k * 4}\n * x \\in [0,1]^2\n */\nCanvas.bilinearInterpolation = function (values, x) {\n  var acc = [];\n  for (var k = 0; k < values.length; k++) {\n    var f03 = values[0][k] + (values[3][k] - values[0][k]) * x[1];\n    var f12 = values[1][k] + (values[2][k] - values[1][k]) * x[1];\n    var f = f03 + (f12 - f03) * x[0];\n    acc.push(f);\n  }\n  return acc;\n};\n/**\n * size: is an array with width and height of a HTML5 Canvas.\n * domId: DOM element where the canvas will be added\n *\n * returns Canvas object from the generated html canvas.\n */\nCanvas.createCanvas = function (size, domId) {\n  const canvas = document.createElement(\"canvas\");\n  canvas.setAttribute(\"width\", size[0]);\n  canvas.setAttribute(\"height\", size[1]);\n  document.getElementById(domId).appendChild(canvas);\n  return canvas;\n};\n\nexport default Canvas;\n","import Canvas from \"./Canvas\";\n\n//Note that we can switch from heritage to composition, think about that\n\n// cameraSpace : 2-dim array with two 2-dim arrays that are intervals [a,b] | a < b\nvar Canvas2D = function (canvas, cameraSpace) {\n  Canvas.call(this, canvas);\n  if (\n    cameraSpace.length != 2 ||\n    (cameraSpace[0].length != 2 && cameraSpace[1].length != 2)\n  ) {\n    throw \"camera space must be 2-dim array with 2-dim arrays representing an interval\";\n  }\n  this.cameraSpace = cameraSpace;\n};\n\nCanvas2D.prototype = Object.create(Canvas.prototype);\nCanvas2D.prototype.constructor = Canvas2D;\n\n/* x : 2-dim array in camera space coordinates\n * returns : 2-dim array in integer coordinates\n */\nCanvas2D.prototype.integerTransform = function (x) {\n  var xint =\n    (-(this.canvas.height - 1) /\n      (this.cameraSpace[1][1] - this.cameraSpace[1][0])) *\n    (x[1] - this.cameraSpace[1][1]);\n  var yint =\n    ((this.canvas.width - 1) /\n      (this.cameraSpace[0][1] - this.cameraSpace[0][0])) *\n    (x[0] - this.cameraSpace[0][0]);\n  return [xint, yint];\n};\n\n/* x : 2-dim array in integer coordinates\n * returns : 2-dim array in camera space coordinates\n */\nCanvas2D.prototype.inverseTransform = function (x) {\n  var xt =\n    this.cameraSpace[0][0] +\n    ((this.cameraSpace[0][1] - this.cameraSpace[0][0]) /\n      (this.canvas.width - 1)) *\n      x[1];\n  var yt =\n    this.cameraSpace[1][1] -\n    ((this.cameraSpace[1][1] - this.cameraSpace[1][0]) /\n      (this.canvas.height - 1)) *\n      x[0];\n  return [xt, yt];\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawLine = function (x1, x2, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  Canvas.prototype.drawLine.call(this, y1, y2, shader);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawTriangle = function (x1, x2, x3, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  const y3 = this.integerTransform(x3);\n  Canvas.prototype.drawTriangle.call(this, y1, y2, y3, shader);\n};\n\n/* x1     :   2-dim array\n * x2     :   2-dim array\n * x3     :   2-dim array\n * x4     :   2-dim array\n * shader :   is a function that receives a 2-dim array and returns a rgba 4-dim array\n */\nCanvas2D.prototype.drawQuad = function (x1, x2, x3, x4, shader) {\n  const y1 = this.integerTransform(x1);\n  const y2 = this.integerTransform(x2);\n  const y3 = this.integerTransform(x3);\n  const y4 = this.integerTransform(x4);\n  Canvas.prototype.drawQuad.call(this, y1, y2, y3, y4, shader);\n};\n\nCanvas2D.prototype.drawCircle = function (x, r, shader) {\n  // it assumes squared canvas, for now ...\n  const y = this.integerTransform(x);\n  const z = this.integerTransform([r, 0])[1] - this.integerTransform([0, 0])[1];\n  Canvas.prototype.drawCircle.call(this, y, z, shader);\n};\n\nCanvas2D.prototype.drawImage = function (img, x) {\n  Canvas.prototype.drawImage.call(this, img, this.integerTransform(x));\n};\n\nCanvas2D.prototype.drawString = function (x, string, contextShader) {\n  const y = this.integerTransform(x);\n  Canvas.prototype.drawString.call(this, y, string, contextShader);\n};\n\n// camera : 2-dim array with two 2-dim arrays that are intervals [a,b] | a < b\nCanvas2D.prototype.setCamera = function (camera) {\n  if (camera.length != 2 || (camera[0].length != 2 && camera[1].length != 2)) {\n    throw \"camera space must be 2-dim array with 2-dim arrays representing an interval\";\n  }\n  this.cameraSpace = camera;\n};\n\nexport default Canvas2D;\n","const ImageIO = {\n  // empty object\n};\n\n/**\n * img : html image\n */\nImageIO.getImageCanvas = img => {\n  const canvasAux = document.createElement(\"canvas\");\n  canvasAux.width = img.width;\n  canvasAux.height = img.height;\n  const contextAux = canvasAux.getContext(\"2d\");\n  contextAux.fillStyle = \"rgba(0, 0, 0, 0)\";\n  contextAux.globalCompositeOperation = \"source-over\";\n  contextAux.fillRect(0, 0, canvasAux.width, canvasAux.height);\n  contextAux.drawImage(img, 0, 0);\n  return canvasAux;\n};\n\n/**\n * img : html image\n */\nImageIO.getDataFromImage = img => {\n  canvas = ImageIO.getImageCanvas(img);\n  return canvas.getContext(\"2d\").getImageData(0, 0, img.width, img.height);\n};\n\nImageIO.loadImage = src => {\n  const img = new Image();\n  img.src = src;\n  img.isReady = false;\n  img.onload = () => (img.isReady = true);\n  return img;\n};\n\nImageIO.generateImageReadyPredicate = img => () => img.isReady;\n\nexport default ImageIO;\n","export default class Color {\n  /**\n   *\n   * @param {*} rgba: Uint8Array\n   */\n  constructor(rgba) {\n    this.rgba = rgba;\n  }\n\n  getRGBA() {\n    return this.rgba;\n  }\n\n  static ofRGBA(red = 0, green = 0, blue = 0, alpha = 255) {\n    const rgba = new Uint8Array(4);\n    rgba[0] = red;\n    rgba[1] = green;\n    rgba[2] = blue;\n    rgba[3] = alpha;\n    return new Color(rgba);\n  }\n\n  static random() {\n    const r = () => Math.random() * 256;\n    return Color.ofRGBA(r(), r(), r(), r());\n  }\n\n  get red() {\n    return this.rgba[0];\n  }\n\n  get green() {\n    return this.rgba[1];\n  }\n\n  get blue() {\n    return this.rgba[2];\n  }\n\n  get alpha() {\n    return this.rgba[3];\n  }\n}\n","//========================================================================================\n/*                                                                                      *\n *                              MATRIX UTILS (order counts)                             *\n *                                                                                      */\n//========================================================================================\n\nconst getIndexFromCoord = (_, m) => (i, j) => j + i * m;\nconst getCoordFromIndex = (_, m) => (k) => [k / m, k % m].map(Math.floor);\nconst index2Key = (i, j) => `${i},${j}`;\nconst key2Index = (k) => k.split(\",\").map(Number);\n\nclass MatrixBuilder {\n  constructor() {\n    this._size = [];\n    this.data = {};\n  }\n\n  size(n, m = 1) {\n    this._size = [n, m];\n    return this;\n  }\n\n  set(i, j, v) {\n    if (this._size.length === 0)\n      throw new MatrixError(\"Setting value to empty matrix\");\n    this.data[index2Key(i, j)] = v;\n    return this;\n  }\n\n  build() {\n    const [n, m] = this._size;\n    const data = new Float64Array(n * m);\n    const indexer = getIndexFromCoord(n, m);\n    Object.keys(this.data).forEach((key) => {\n      data[indexer(...key2Index(key))] = this.data[key];\n    });\n    return new Matrix(data, this._size);\n  }\n}\n\nclass RowBuilder {\n  constructor() {\n    this.rows = [];\n    this.dim = 0;\n  }\n\n  addRow(...array) {\n    if (this.dim === 0) {\n      this.dim = array.length;\n    }\n    if (this.dim !== array.length)\n      throw new MatrixError(\n        `Added row of different dimension, actual dim is ${this.dim}`\n      );\n    this.rows.push(array);\n    return this;\n  }\n\n  build() {\n    if (this.rows.length > 0) return this.#buildWithRows();\n    throw new MatrixError(\"Building empty matrix\");\n  }\n\n  #buildWithRows() {\n    const rows = this.rows.length;\n    const cols = this.dim;\n    const data = new Float64Array(rows * cols);\n    const indexF = getIndexFromCoord(rows, cols);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < cols; j++) {\n        data[indexF(i, j)] = this.rows[i][j];\n      }\n    }\n    return new Matrix(data, [rows, cols]);\n  }\n}\n\nclass ColBuilder {\n  constructor() {\n    this.cols = [];\n    this.dim = 0;\n  }\n\n  addCol(...array) {\n    if (this.dim === 0) {\n      this.dim = array.length;\n    }\n    if (this.dim !== array.length)\n      throw new MatrixError(\n        `Added col of different dimension, actual dim is ${this.dim}`\n      );\n    this.cols.push(array);\n    return this;\n  }\n\n  build() {\n    if (this.cols.length > 0) return this.#buildWithCols();\n    throw new MatrixError(\"Building empty matrix\");\n  }\n\n  #buildWithCols() {\n    const rows = this.dim;\n    const cols = this.cols.length;\n    const data = new Float64Array(rows * cols);\n    const indexF = getIndexFromCoord(rows, cols);\n    for (let i = 0; i < rows; i++) {\n      for (let j = 0; j < cols; j++) {\n        data[indexF(i, j)] = this.cols[j][i];\n      }\n    }\n    return new Matrix(data, [rows, cols]);\n  }\n}\n\n//========================================================================================\n/*                                                                                      *\n *                                        MATRIX                                        *\n *                                                                                      */\n//========================================================================================\n\nexport default class Matrix {\n  /**\n   *\n   * @param {*} data: Float64Array; Matrix data in major row format\n   * @param {*} shape: 2-array [rows,columns]\n   */\n  constructor(data, shape) {\n    this.data = data;\n    this.shape = shape;\n  }\n\n  get rows() {\n    return this.shape[0];\n  }\n\n  get cols() {\n    return this.shape[1];\n  }\n\n  get(i = 0, j = 0) {\n    const [_, cols] = this.shape;\n    return this.data[j + i * cols];\n  }\n\n  prod(matrix) {\n    if (this.cols !== matrix.rows) {\n      throw new MatrixError(\n        `Incompatible product size. Left ${this.shape}, right ${matrix.shape}`\n      );\n    }\n    const n = this.rows;\n    const m = this.cols;\n    const l = matrix.cols;\n    const prod = new Float64Array(n * l);\n    const indexer = getIndexFromCoord(n, l);\n    for (let i = 0; i < n; i++) {\n      for (let j = 0; j < l; j++) {\n        let acc = 0;\n        for (let k = 0; k < m; k++) {\n          acc += this.get(i, k) * matrix.get(k, j);\n        }\n        prod[indexer(i, j)] = acc;\n      }\n    }\n\n    return new Matrix(prod, [n, l]);\n  }\n\n  dot(matrix) {\n    if (this.rows !== matrix.rows)\n      throw new MatrixError(\n        `Incompatible product size. Left ${this.shape}, right ${matrix.shape}`\n      );\n    const n = this.rows;\n    const m = this.cols;\n    const l = matrix.cols;\n    const prod = new Float64Array(m * l);\n    const indexer = getIndexFromCoord(m, l);\n    for (let i = 0; i < m; i++) {\n      for (let j = 0; j < l; j++) {\n        let acc = 0;\n        for (let k = 0; k < n; k++) {\n          acc += this.get(k, i) * matrix.get(k, j);\n        }\n        prod[indexer(i, j)] = acc;\n      }\n    }\n\n    return new Matrix(prod, [m, l]);\n  }\n\n  /**\n   *\n   * @param {*} lambda: (number, i, j) => number\n   * @returns Matrix\n   */\n  map(lambda = (x) => x) {\n    const getCoord = getCoordFromIndex(...this.shape);\n    return new Matrix(\n      this.data.map((x, k) => {\n        const [i, j] = getCoord(k);\n        return lambda(x, i, j);\n      }),\n      this.shape\n    );\n  }\n\n  /**\n   *\n   * @param {*} lambda (accumulator, number, i, j) => number\n   * @param {*} identity\n   */\n  reduce(lambda, identity = 0) {\n    const getCoord = getCoordFromIndex(...this.shape);\n    return this.data.reduce((e, x, k) => {\n      const [i, j] = getCoord(k);\n      return lambda(e, x, i, j);\n    }, identity);\n  }\n\n  fold = this.reduce;\n\n  /**\n   *\n   * @param {*} binaryLambda: (number,number) => number\n   */\n  op(matrix, binaryLambda) {\n    const [rows, cols] = this.shape;\n    const [mRows, mCols] = matrix.shape;\n    if (rows !== mRows || cols !== mCols)\n      throw new MatrixError(\"Matrix must be of same size\");\n    return new Matrix(\n      this.data.map((x, i) => binaryLambda(x, matrix.data[i])),\n      this.shape\n    );\n  }\n\n  add(matrix) {\n    return this.op(matrix, (a, b) => a + b);\n  }\n\n  sub(matrix) {\n    return this.op(matrix, (a, b) => a - b);\n  }\n\n  mul(matrix) {\n    return this.op(matrix, (a, b) => a * b);\n  }\n\n  div(matrix) {\n    return this.op(matrix, (a, b) => a / b);\n  }\n\n  scale(real) {\n    return this.map((x) => x * real);\n  }\n\n  norm() {\n    let acc = 0;\n    for (let i = 0; i < this.data.length; i++) {\n      acc += this.data[i] * this.data[i];\n    }\n    return Math.sqrt(acc);\n  }\n\n  length = this.norm;\n\n  equals(matrix, precision = 1e-6) {\n    if (!(matrix instanceof Matrix)) return false;\n    try {\n      return this.sub(matrix).length() < precision;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  static id = (n, m = n) => {\n    const en = Matrix.e(n);\n    let matrixBuilder = Matrix.colBuilder();\n    for (let i = 0; i < m; i++) {\n      matrixBuilder = matrixBuilder.addCol(...en(i).data);\n    }\n    return matrixBuilder.build();\n  };\n\n  static e = (n) => (i) => {\n    return new Matrix(\n      new Float64Array(n).map((_, j) => (i === j ? 1 : 0)),\n      [n, 1]\n    );\n  };\n\n  static dx = (n) => (i) => {\n    return new Matrix(\n      new Float64Array(n).map((_, j) => (i === j ? 1 : 0)),\n      [1, n]\n    );\n  };\n\n  static ZERO(n, m = 1) {\n    return Matrix.builder().size(n, m).build();\n  }\n\n  static builder() {\n    return new MatrixBuilder();\n  }\n\n  static rowBuilder() {\n    return new RowBuilder();\n  }\n\n  static colBuilder() {\n    return new ColBuilder();\n  }\n\n  static vec(...array) {\n    return new ColBuilder().addCol(...array).build();\n  }\n\n  static cov(...array) {\n    return new RowBuilder().addRow(...array).build();\n  }\n\n  static vec2 = {\n    of: (x = 0, y = 0) => Matrix.vec(x, y),\n    e0: Matrix.vec(1, 0),\n    e1: Matrix.vec(0, 1),\n    ZERO: Matrix.ZERO(2, 1),\n  };\n\n  static vec3 = {\n    of: (x = 0, y = 0, z = 0) => Matrix.vec(x, y, z),\n    e0: Matrix.vec(1, 0, 0),\n    e1: Matrix.vec(0, 1, 0),\n    e2: Matrix.vec(0, 0, 1),\n    ZERO: Matrix.ZERO(3, 1),\n  };\n}\n\nexport class MatrixError extends Error {}\n","export const perf = (lambda) => {\n  const t = performance.now();\n  lambda();\n  return performance.now() - t;\n};\n\n/**\n * Unit test maker\n * @param {*} title\n * @param {*} lambda: (width:number, height: number) => {}\n */\nexport function test(title, lambda = () => {}) {\n  let canvas;\n  const canvasFactory = (width, height) => {\n    canvas = Canvas.builder().width(width).height(height).build();\n    return canvas;\n  };\n  const timeInMillis = perf(() => lambda(canvasFactory));\n  const domTest = document.createElement(\"div\");\n  const testTitle = document.createElement(\"h3\");\n  testTitle.innerText = title;\n  domTest.appendChild(testTitle);\n  domTest.appendChild(canvas.getDom());\n  const timeDom = document.createElement(\"h4\");\n  timeDom.innerText = `Test took ${timeInMillis}ms`;\n  domTest.appendChild(timeDom);\n  document.body.appendChild(domTest);\n}\n","import Canvas_old from \"./Canvas_old/main/Canvas\";\nimport Canvas2D_old from \"./Canvas_old/main/Canvas2D\";\nimport ImageIO from \"./Canvas_old/main/ImageIO\";\nimport Canvas from \"./Canvas/main/Canvas\";\nimport Color from \"./Color/main/Color\";\nimport * as Utils from \"./Utils/main/Utils\";\nimport Animator from \"./Animator/main/Animator\";\nimport Matrix from \"./Matrix/main/Matrix\";\nexport {\n  Canvas_old,\n  Canvas2D_old,\n  ImageIO,\n  Canvas,\n  Color,\n  Utils,\n  Animator,\n  Matrix,\n};\n","module.exports = require(\"@babel/runtime/helpers/esm/classCallCheck\");","module.exports = require(\"@babel/runtime/helpers/esm/createClass\");","module.exports = require(\"@babel/runtime/helpers/esm/defineProperty\");","module.exports = require(\"@babel/runtime/helpers/esm/getPrototypeOf\");","module.exports = require(\"@babel/runtime/helpers/esm/inherits\");","module.exports = require(\"@babel/runtime/helpers/esm/possibleConstructorReturn\");","module.exports = require(\"@babel/runtime/helpers/esm/slicedToArray\");","module.exports = require(\"@babel/runtime/helpers/esm/toConsumableArray\");","module.exports = require(\"@babel/runtime/helpers/esm/wrapNativeSuper\");"],"sourceRoot":""}